/**
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013 p2.js authors
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(a){if("function"==typeof bootstrap)bootstrap("p2",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeP2=a}else"undefined"!=typeof window?window.p2=a():self.p2=a()}(function(){return function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b){b.exports={Body:a("./objects/Body"),Broadphase:a("./collision/Broadphase"),Capsule:a("./shapes/Capsule"),Circle:a("./shapes/Circle"),Constraint:a("./constraints/Constraint"),ContactEquation:a("./constraints/ContactEquation"),Convex:a("./shapes/Convex"),DistanceConstraint:a("./constraints/DistanceConstraint"),Equation:a("./constraints/Equation"),EventEmitter:a("./events/EventEmitter"),FrictionEquation:a("./constraints/FrictionEquation"),GridBroadphase:a("./collision/GridBroadphase"),GSSolver:a("./solver/GSSolver"),Island:a("./solver/IslandSolver"),IslandSolver:a("./solver/IslandSolver"),Line:a("./shapes/Line"),NaiveBroadphase:a("./collision/NaiveBroadphase"),Particle:a("./shapes/Particle"),Plane:a("./shapes/Plane"),PointToPointConstraint:a("./constraints/PointToPointConstraint"),Rectangle:a("./shapes/Rectangle"),Shape:a("./shapes/Shape"),Solver:a("./solver/Solver"),Spring:a("./objects/Spring"),World:a("./world/World"),vec2:a("./math/vec2"),version:a("../package.json").version}},{"../package.json":2,"./objects/Body":3,"./collision/Broadphase":4,"./shapes/Capsule":5,"./shapes/Circle":6,"./constraints/Constraint":7,"./constraints/ContactEquation":8,"./shapes/Convex":9,"./constraints/DistanceConstraint":10,"./constraints/Equation":11,"./events/EventEmitter":12,"./constraints/FrictionEquation":13,"./collision/GridBroadphase":14,"./solver/GSSolver":15,"./solver/IslandSolver":16,"./shapes/Line":17,"./collision/NaiveBroadphase":18,"./shapes/Particle":19,"./shapes/Plane":20,"./constraints/PointToPointConstraint":21,"./shapes/Rectangle":22,"./shapes/Shape":23,"./solver/Solver":24,"./objects/Spring":25,"./world/World":26,"./math/vec2":27}],2:[function(a,b){b.exports={name:"p2",version:"0.1.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./build/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest",nodeunit:"latest",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"*","grunt-browserify":"*","gl-matrix":"2.0.0"},dependencies:{}}},{}],7:[function(a,b){function c(a,b){this.equations=[],this.bodyA=a,this.bodyB=b}b.exports=c},{}],11:[function(a,b){function c(a,b,c,d){this.id=-1,this.minForce="undefined"==typeof c?-1e6:c,this.maxForce="undefined"==typeof d?1e6:d,this.bi=a,this.bj=b,this.h=1/60,this.k=0,this.a=0,this.b=0,this.eps=0,this.setSpookParams(1e6,4)}b.exports=c,c.prototype.constructor=c,c.prototype.setSpookParams=function(a,b){var c=this.h;this.k=a,this.d=b,this.a=4/(c*(1+4*b)),this.b=4*b/(1+4*b),this.eps=4/(c*c*a*(1+4*b))}},{}],12:[function(a,b){var c=function(){};b.exports=c,c.prototype={constructor:c,on:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;return void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b),this},has:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},off:function(a,b){if(void 0!==this._listeners){var c=this._listeners,d=c[a].indexOf(b);-1!==d&&c[a].splice(d,1)}},emit:function(a){if(void 0!==this._listeners){var b=this._listeners,c=b[a.type];if(void 0!==c){a.target=this;for(var d=0,e=c.length;e>d;d++)c[d].call(this,a)}return this}}}},{}],23:[function(a,b){function c(a){this.type=a}b.exports=c,c.CIRCLE=1,c.PARTICLE=2,c.PLANE=4,c.CONVEX=8,c.LINE=16,c.RECTANGLE=32,c.CAPSULE=64,c.prototype.computeMomentOfInertia=function(){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")}},{}],24:[function(a,b){function c(){this.equations=[]}b.exports=c,c.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")},c.prototype.addEquation=function(a){this.equations.push(a)},c.prototype.removeEquation=function(a){var b=this.equations.indexOf(a);-1!=b&&this.equations.splice(b,1)},c.prototype.removeAllEquations=function(){this.equations=[]}},{}],3:[function(a,b){function c(a){a=a||{},this.id=++c._idCounter,this.shapes=[],this.shapeOffsets=[],this.shapeAngles=[],this.mass=a.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.updateMassProperties(),this.position=d.fromValues(0,0),a.position&&d.copy(this.position,a.position),this.velocity=d.fromValues(0,0),a.velocity&&d.copy(this.velocity,a.velocity),this.vlambda=d.fromValues(0,0),this.wlambda=0,this.angle=a.angle||0,this.angularVelocity=a.angularVelocity||0,this.force=d.create(),a.force&&d.copy(this.force,a.force),this.angularForce=a.angularForce||0,this.motionState=0==this.mass?c.STATIC:c.DYNAMIC}var d=a("../math/vec2");b.exports=c,c._idCounter=0,c.prototype.addShape=function(a,b,c){this.shapes.push(a),this.shapeOffsets.push(b),this.shapeAngles.push(c),this.updateMassProperties()};var e=d.fromValues(0,0);c.prototype.updateMassProperties=function(){for(var a=this.shapes,b=a.length,c=this.mass/b,f=0,g=0;b>g;g++){var h=a[g],i=d.squaredLength(this.shapeOffsets[g]||e),j=h.computeMomentOfInertia(c);f+=j+c*i}this.inertia=f,this.invMass=this.mass>0?1/this.mass:0,this.invInertia=f>0?1/f:0};var f=d.create();c.prototype.applyForce=function(a,b){var c=f;d.sub(c,b,this.position),d.add(this.force,this.force,a);var e=d.crossLength(c,a);this.angularForce+=e},c.prototype.toLocalFrame=function(a,b){d.toLocalFrame(a,b,this.position,this.angle)},c.prototype.toWorldFrame=function(a,b){d.toGlobalFrame(a,b,this.position,this.angle)},c.DYNAMIC=1,c.STATIC=2,c.KINEMATIC=4},{"../math/vec2":27}],4:[function(a,b){function c(){}var d=a("../math/vec2"),e=a("./Nearphase");b.exports=c,c.prototype.getCollisionPairs=function(){throw new Error("getCollisionPairs must be implemented in a subclass!")};var f=d.create(),g=d.create(),h=d.fromValues(0,1);c.circleConvex=function(){return!0},c.capsulePlane=function(){return!0},c.circleLine=function(a,b,c,e){d.sub(f,e,b);var g=a.radius,h=c.length;return d.squaredLength(f)<Math.pow(h+g,2)},c.planeLine=function(a,b,c,e,i){d.sub(f,i,b),d.rotate(g,h,c);var j=e.length;return d.dot(f,g)<j},c.rectangleRectangle=function(a,b,c,e,g){d.sub(f,g,b);var h=a.width,i=a.height,j=Math.sqrt(h*h+i*i)/2,k=e.width,l=e.height,m=Math.sqrt(k*k+l*l)/2,n=d.sqrLen(f)<(j+m)*(j+m);return n},c.convexConvex=function(){return!0},c.circleRectangle=function(a,b,c,e){d.sub(f,b,e);var g=a.radius,h=c.width,i=c.height,j=Math.sqrt(h*h+i*i)/2,k=d.sqrLen(f)<(g+j)*(g+j);return k},c.circleCircle=function(a,b,c,e){d.sub(f,b,e);var g=a.radius,h=c.radius;return d.sqrLen(f)<(g+h)*(g+h)};var i=d.create();c.convexPlane=function(a,b,c,f,j,k){var l=i;d.rotate(g,h,k),e.projectConvexOntoAxis(a,b,c,g,l);var m=d.dot(j,g);return l[0]<m},c.particlePlane=function(a,b,c,e,i){return i=i||0,d.sub(f,b,e),d.rotate(g,h,i),d.dot(f,g)<0?!0:!1},c.circleParticle=function(a,b,c,e){var g=a.radius;return d.sub(f,b,e),d.squaredLength(f)<g*g},c.rectangleParticle=function(a,b,c,e){d.sub(f,e,b);var g=a.width,h=a.height,i=Math.sqrt(g*g+h*h)/2,j=d.sqrLen(f)<i*i;return j},c.convexParticle=function(a,b,c,e){d.sub(f,e,b);var g=a.boundingRadius,h=d.sqrLen(f)<g*g;return h},c.circlePlane=function(a,b,c,e,i){return i=i||0,d.sub(f,b,e),d.rotate(g,h,i),d.dot(f,g)<=a.radius?!0:!1}},{"../math/vec2":27,"./Nearphase":28}],5:[function(a,b){function c(a,b){d.call(this,d.CAPSULE),this.length=a||1,this.radius=b||1}var d=a("./Shape");a("../math/vec2"),b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(a){var b=this.radius,c=this.length+b,d=2*b;return a*(d*d+c*c)/12}},{"./Shape":23,"../math/vec2":27}],6:[function(a,b){function c(a){d.call(this,d.CIRCLE),this.radius=a||1}var d=a("./Shape");b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(a){var b=this.radius;return a*b*b/2}},{"./Shape":23}],8:[function(a,b){function c(a,b){d.call(this,a,b,0,1e6),this.penetration=0,this.ri=e.create(),this.penetrationVec=e.create(),this.rj=e.create(),this.ni=e.create(),this.rixn=e.create(),this.rjxn=e.create(),this.rixw=e.create(),this.rjxw=e.create(),this.relVel=e.create(),this.relForce=e.create()}var d=a("./Equation"),e=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.constructor=c,c.prototype.computeB=function(a,b,c){var d=this.bi,f=this.bj,g=this.ri,h=this.rj,i=d.position,j=f.position,k=d.velocity,l=d.angularVelocity,m=d.force,n=d.angularForce,o=f.velocity,p=f.angularVelocity,q=f.force,r=f.angularForce,s=(this.relVel,this.relForce,this.penetrationVec),t=d.invMass,u=f.invMass,v=d.invInertia,w=f.invInertia,x=this.ni,y=this.rixn=e.crossLength(g,x),z=this.rjxn=e.crossLength(h,x);e.set(s,0,0),e.add(s,j,h),e.sub(s,s,i),e.sub(s,s,g);var A=e.dot(x,s),B=e.dot(o,x)-e.dot(k,x)+p*z-l*y,C=e.dot(q,x)*u-e.dot(m,x)*t+w*r*z-v*n*y,D=-A*a-B*b-c*C;return D},c.prototype.computeC=function(a){var b=this.bi,c=this.bj,d=this.rixn,e=this.rjxn,f=b.invMass+c.invMass+a;return f+=b.invInertia*d*d,f+=c.invInertia*e*e};{e.create()}c.prototype.computeGWlambda=function(){var a=this.bi,b=this.bj,c=0;return c-=e.dot(this.ni,a.vlambda),c-=a.wlambda*this.rixn,c+=e.dot(this.ni,b.vlambda),c+=b.wlambda*this.rjxn};var f=e.create();c.prototype.addToWlambda=function(a){var b=this.bi,c=this.bj,d=this.rixn,g=this.rjxn,h=this.ni,i=f;e.scale(i,h,-b.invMass*a),e.add(b.vlambda,b.vlambda,i),e.scale(i,h,c.invMass*a),e.add(c.vlambda,c.vlambda,i),b.wlambda-=b.invInertia*d*a,c.wlambda+=c.invInertia*g*a}},{"./Equation":11,"../math/vec2":27}],9:[function(a,b){function c(a){d.call(this,d.CONVEX),this.vertices=a||[],this.centerOfMass=e.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,this.updateBoundingRadius()}var d=a("./Shape"),e=a("../math/vec2"),f=a("../math/polyk");b.exports=c,c.prototype=new d,c.prototype.updateTriangles=function(){this.triangles.length=0;for(var a=[],b=0;b<this.vertices.length;b++){var c=this.vertices[b];a.push(c[0],c[1])}for(var d=f.Triangulate(a),b=0;b<d.length;b+=3){var e=d[b],g=d[b+1],h=d[b+2];this.triangles.push([e,g,h])}};{var g=e.create(),h=e.create(),i=e.create(),j=e.create(),k=e.create(),l=(e.create(),e.create()),m=e.create();e.create()}c.prototype.updateCenterOfMass=function(){var a=this.triangles,b=this.vertices,c=this.centerOfMass,d=g,f=i,n=j,o=k,p=l,q=m,r=h;e.set(c,0,0);for(var s=0;s<a.length;s++){var t=a[s],f=b[t[0]],n=b[t[1]],o=b[t[2]];e.centroid(d,f,n,o),e.sub(p,o,f),e.sub(q,o,n);var u=.5*e.crossLength(p,q);e.scale(r,d,u),e.add(c,c,r)}},c.prototype.computeMomentOfInertia=function(a){for(var b=0,c=[],d=0;d<this.vertices.length;d++){var g=this.vertices[d];c.push(g[0],g[1])}var h=f.Triangulate(c),i=f.GetArea(c),j=a/i,k=e.create(),l=e.create(),m=e.create(),n=e.create(),o=(e.create(),e.create(),e.create()),p=e.create();e.create();for(var d=0;d<h.length;d+=3){var q=h[d],r=h[d+1],s=h[d+2];e.set(k,c[2*q],c[2*q+1]),e.set(l,c[2*r],c[2*r+1]),e.set(m,c[2*s],c[2*s+1]),e.centroid(n,k,l,m),e.sub(o,m,k),e.sub(p,m,l);var t=.5*e.crossLength(o,p),u=e.length(o),v=2*t/u,w=u*Math.pow(v,3)/36,x=u*v/2*j,y=e.squaredLength(n);b+=w+x*y}return b},c.prototype.updateBoundingRadius=function(){for(var a=this.vertices,b=0,c=0;c<a.length;c++){var d=e.squaredLength(a[c]);d>b&&(b=d)}this.boundingRadius=Math.sqrt(b)}},{"./Shape":23,"../math/vec2":27,"../math/polyk":29}],10:[function(a,b){function c(a,b,c,f){d.call(this,a,b),this.distance=c,"undefined"==typeof f&&(f=1e6);var g=this.equations=[new e(a,b)],h=g[0];h.minForce=-f,h.maxForce=f}var d=a("./Constraint"),e=a("./ContactEquation"),f=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.update=function(){var a=this.equations[0],b=this.bodyA,c=this.bodyB,d=this.distance;f.subtract(a.ni,c.position,b.position),f.normalize(a.ni,a.ni),f.scale(a.ri,a.ni,.5*d),f.scale(a.rj,a.ni,.5*-d)}},{"./Constraint":7,"./ContactEquation":8,"../math/vec2":27}],13:[function(a,b){function c(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a}function d(a,b,c){f.call(this,a,b,-c,c),this.ri=e.create(),this.rj=e.create(),this.t=e.create(),this.rixt=0,this.rjxt=0}var e=a("../math/vec2"),f=a("./Equation");b.exports=d;var g=e.dot;d.prototype=new f,d.prototype.constructor=d,d.prototype.setSlipForce=function(a){this.maxForce=a,this.minForce=-a};var h=[0,0,0],i=[0,0,0];d.prototype.computeB=function(a,b,d){var a=this.a,b=this.b,e=this.bi,f=this.bj,j=this.ri,k=this.rj,l=this.rixt,m=this.rjxt,n=this.t;c(h,[j[0],j[1],0],[n[0],n[1],0]),c(i,[k[0],k[1],0],[n[0],n[1],0]);var l=this.rixt=h[2],m=this.rjxt=i[2],o=0,p=-g(e.velocity,n)+g(f.velocity,n)-l*e.angularVelocity+m*f.angularVelocity,q=-g(e.force,n)*e.invMass+g(f.force,n)*f.invMass-l*e.invInertia*e.angularForce+m*f.invInertia*f.angularForce,r=-o*a-p*b-d*q;return r},d.prototype.computeC=function(a){var b,c=this.bi,d=this.bj,e=this.rixt,f=this.rjxt;return b=c.invMass+d.invMass+a,b+=c.invInertia*e*e,b+=d.invInertia*f*f},d.prototype.computeGWlambda=function(){var a=this.bi,b=this.bj,c=0;return c-=e.dot(this.t,a.vlambda),c-=a.wlambda*this.rixt,c+=e.dot(this.t,b.vlambda),c+=b.wlambda*this.rjxt};var j=e.create();d.prototype.addToWlambda=function(a){var b=this.bi,c=this.bj,d=this.rixt,f=this.rjxt,g=this.t,h=j;e.scale(h,g,-b.invMass*a),e.add(b.vlambda,b.vlambda,h),e.scale(h,g,c.invMass*a),e.add(c.vlambda,c.vlambda,h),b.wlambda-=b.invInertia*d*a,c.wlambda+=c.invInertia*f*a}},{"../math/vec2":27,"./Equation":11}],14:[function(a,b){function d(a,b,c,d,e,f){h.apply(this),e=e||10,f=f||10,this.binsizeX=(b-a)/e,this.binsizeY=(d-c)/f,this.nx=e,this.ny=f,this.xmin=a,this.ymin=c,this.xmax=b,this.ymax=d}var e=a("../shapes/Circle"),f=a("../shapes/Plane"),g=a("../shapes/Particle"),h=a("../collision/Broadphase");a("../math/vec2"),b.exports=d,d.prototype=new h,d.prototype.getBinIndex=function(a,b){var c=this.nx,d=this.ny,e=this.xmin,f=this.ymin,g=this.xmax,h=this.ymax,i=Math.floor(c*(a-e)/(g-e)),j=Math.floor(d*(b-f)/(h-f));return i*d+j},d.prototype.getCollisionPairs=function(a){for(var b=[],d=a.bodies,i=i=d.length,j=this.binsizeX,k=this.binsizeY,l=[],m=nx*ny,n=0;m>n;n++)l.push([]);for(var o=nx/(xmax-xmin),p=ny/(ymax-ymin),n=0;n!==i;n++){var q=d[n],r=q.shape;if(void 0!==r)if(r instanceof e)for(var s=q.position[0],t=q.position[1],u=r.radius,v=Math.floor(o*(s-u-xmin)),w=Math.floor(p*(t-u-ymin)),x=Math.floor(o*(s+u-xmin)),y=Math.floor(p*(t+u-ymin)),z=v;x>=z;z++)for(var A=w;y>=A;A++){var B=z,C=A;B*(ny-1)+C>=0&&m>B*(ny-1)+C&&l[B*(ny-1)+C].push(q)}else{if(!(r instanceof f))throw new Error("Shape not supported in GridBroadphase!");if(0==q.angle)for(var t=q.position[1],z=0;z!==m&&t>ymin+k*(z-1);z++)for(var A=0;nx>A;A++){var B=A,C=Math.floor(p*(k*z-ymin));l[B*(ny-1)+C].push(q)}else if(q.angle==.5*Math.PI)for(var s=q.position[0],z=0;z!==m&&s>xmin+j*(z-1);z++)for(var A=0;ny>A;A++){var C=A,B=Math.floor(o*(j*z-xmin));l[B*(ny-1)+C].push(q)}else for(var z=0;z!==m;z++)l[z].push(q)}}for(var n=0;n!==m;n++)for(var D=l[n],z=0,E=D.length;z!==E;z++)for(var q=D[z],r=q.shape,A=0;A!==z;A++){var F=D[A],G=F.shape;r instanceof e?G instanceof e?c=h.circleCircle(q,F):G instanceof g?c=h.circleParticle(q,F):G instanceof f&&(c=h.circlePlane(q,F)):r instanceof g?G instanceof e&&(c=h.circleParticle(F,q)):r instanceof f&&G instanceof e&&(c=h.circlePlane(F,q))}return b}},{"../shapes/Circle":6,"../shapes/Plane":20,"../shapes/Particle":19,"../collision/Broadphase":4,"../math/vec2":27}],15:[function(a,b){function c(a){e.call(this),a=a||{},this.iterations=a.iterations||10,this.h=a.timeStep||1/60,this.k=a.stiffness||1e7,this.d=a.relaxation||6,this.a=0,this.b=0,this.eps=0,this.tolerance=a.tolerance||0,this.setSpookParams(this.k,this.d),this.debug=a.debug||!1,this.arrayStep=30,this.lambda=new f(this.arrayStep),this.Bs=new f(this.arrayStep),this.invCs=new f(this.arrayStep),this.setSpookParams(1e6,4)}var d=a("../math/vec2"),e=a("./Solver");b.exports=c;var f=Float32Array||Array;c.prototype=new e,c.prototype.setSpookParams=function(a,b){var c=this.h;this.k=a,this.d=b,this.a=4/(c*(1+4*b)),this.b=4*b/(1+4*b),this.eps=4/(c*c*a*(1+4*b))},c.prototype.solve=function(a,b){var c=(this.d,this.k,0),e=this.iterations,g=this.tolerance*this.tolerance,h=this.a,i=this.b,j=this.eps,k=this.equations,l=k.length,m=b.bodies,n=b.bodies.length,o=a;this.lambda.length<l&&(this.lambda=new f(l+this.arrayStep),this.Bs=new f(l+this.arrayStep),this.invCs=new f(l+this.arrayStep));for(var p=this.invCs,q=this.Bs,r=this.lambda,s=0;s!==l;s++){var t=k[s];r[s]=0,q[s]=t.computeB(h,i,o),p[s]=1/t.computeC(j)}var u,t,v,w,x,y,z;if(0!==l){var s,A,B,C,D;for(s=0;s!==n;s++){var i=m[s],E=i.vlambda;d.set(E,0,0),i.wlambda=0}for(c=0;c!==e;c++){for(x=0,A=0;A!==l;A++)t=k[A],C=t.maxForce,B=t.minForce,u=q[A],v=p[A],z=r[A],y=t.computeGWlambda(j),w=v*(u-y-j*z),D=z+w,B>D?w=B-z:D>C&&(w=C-z),r[A]+=w,x+=Math.abs(w),t.addToWlambda(w);if(g>=x*x)break}for(s=0;s!==n;s++){var i=m[s],F=i.velocity;d.add(F,F,i.vlambda),i.angularVelocity+=i.wlambda}}errorTot=x}},{"../math/vec2":27,"./Solver":24}],16:[function(a,b){function c(a){f.call(this),this.subsolver=a,this.numIslands=0,this._nodePool=[]}function d(a){for(var b=a.length,c=0;c!==b;c++){var d=a[c];if(!(d.visited||d.body.motionState&i))return d}return!1}function e(a,b){var c=[];for(c.push(a),a.visited=!0,b(a);c.length;)for(var e,f=c.pop();e=d(f.children);)e.visited=!0,b(e),c.push(e)}var f=a("./Solver"),g=(a("../math/vec2"),a("../solver/Island")),h=a("../objects/Body"),i=h.STATIC;b.exports=c,c.prototype=new Object(f.prototype),c.prototype.solve=function(a,b){function c(a){v.push(a.body);for(var b=a.eqs.length,c=0;c!==b;c++){var d=a.eqs[c];-1===u.indexOf(d)&&u.push(d)}}var f=[],h=b.bodies,i=this.equations,j=i.length,k=h.length;this.subsolver,this._workers,this._workerData,this._workerIslandGroups;for(var l=0;l!==k;l++)this._nodePool.length?f.push(this._nodePool.pop()):f.push({body:h[l],children:[],eqs:[],visited:!1});for(var l=0;l!==k;l++){var m=f[l];m.body=h[l],m.children.length=0,m.eqs.length=0,m.visited=!1}for(var n=0;n!==j;n++){var o=i[n],l=h.indexOf(o.bi),p=h.indexOf(o.bj),q=f[l],r=f[p];q.children.push(r),q.eqs.push(o),r.children.push(q),r.eqs.push(o)}for(var s,t=0,u=[],v=[],w=[];s=d(f);){var x=new g;u.length=0,v.length=0,e(s,c);for(var y=u.length,l=0;l!==y;l++){var o=u[l];x.equations.push(o)}t++,w.push(x)}this.numIslands=t;for(var l=0;l<w.length;l++)w[l].solve(a,this.subsolver)}},{"./Solver":24,"../math/vec2":27,"../solver/Island":30,"../objects/Body":3}],17:[function(a,b){function c(a){d.call(this,d.LINE),this.length=a}var d=a("./Shape");b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(a){return a*Math.pow(this.length,2)/12}},{"./Shape":23}],19:[function(a,b){function c(){d.call(this,d.PARTICLE)}var d=a("./Shape");b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(){return 0}},{"./Shape":23}],18:[function(a,b){function c(){e.apply(this)}var d=(a("../shapes/Circle"),a("../shapes/Plane"),a("../shapes/Shape")),e=(a("../shapes/Particle"),a("../collision/Broadphase")),f=a("../math/vec2");b.exports=c,c.prototype=new Object(e.prototype);var g=f.fromValues(0,0),h=f.fromValues(0,0),i=f.fromValues(0,0);c.prototype.getCollisionPairs=function(a){for(var b=a.bodies,c=[],j=0,k=b.length;j!==k;j++)for(var l=b[j],m=0;j>m;m++)for(var n=b[m],o=!1,p=0;!o&&p<l.shapes.length;p++)for(var q=l.shapes[p],r=l.shapeOffsets[p]||i,s=l.shapeAngles[p]||0,t=0;!o&&t<n.shapes.length;t++){var u=n.shapes[t],v=n.shapeOffsets[t]||i,w=n.shapeAngles[t]||0,x=l,y=n,z=q,A=u,B=r,C=v,D=s,E=w;if(z.type>A.type){var F;F=x,x=y,y=F,F=z,z=A,A=F,F=B,B=C,C=F,F=D,D=E,E=F}f.rotate(g,B,x.angle),f.rotate(h,C,y.angle),f.add(g,g,x.position),f.add(h,h,y.position);var G=D+x.angle,H=E+y.angle;switch(z.type){case d.CIRCLE:switch(A.type){case d.CIRCLE:o=e.circleCircle(z,g,A,h);break;case d.PLANE:o=e.circlePlane(z,g,A,h,H);break;case d.PARTICLE:o=e.circleParticle(z,g,A,h);break;case d.LINE:o=e.circleLine(z,g,A,h,H);break;case d.CONVEX:o=A instanceof Rectangle?e.circleRectangle(z,g,A,h):e.circleConvex(z,g,A,h)}break;case d.PARTICLE:switch(A.type){case d.PLANE:o=e.particlePlane(z,g,A,h,H);break;case d.CONVEX:o=A instanceof Rectangle?e.rectangleParticle(A,h,z,g):e.convexParticle(A,h,z,g)}break;case d.PLANE:switch(A.type){case d.CONVEX:o=e.convexPlane(A,h,H,z,g,G);break;case d.LINE:o=e.planeLine(z,g,G,A,h,H);break;case d.CAPSULE:o=e.capsulePlane(A,h,H,z,g,G)}break;case d.CONVEX:if(z instanceof Rectangle&&A instanceof Rectangle)o=e.rectangleRectangle(A,h,H,z,g,G);else switch(A.type){case d.CONVEX:o=e.convexConvex(A,h,H,z,g,G)}}o&&(o=!0,c.push(x,y))}return c}},{"../shapes/Circle":6,"../shapes/Plane":20,"../shapes/Shape":23,"../shapes/Particle":19,"../collision/Broadphase":4,"../math/vec2":27}],20:[function(a,b){function c(){d.call(this,d.PLANE)}var d=a("./Shape");b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(){return 0}},{"./Shape":23}],21:[function(a,b){function c(a,b,c,f,g){d.call(this,a,c),g="undefined"!=typeof g?g:1e7,this.pivotA=b,this.pivotB=f;var h=this.equations=[new e(a,c),new e(a,c)],i=h[0],j=h[1];j.minForce=i.minForce=-g,j.maxForce=i.maxForce=g}var d=a("./Constraint"),e=a("./ContactEquation"),f=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=this.pivotA,d=this.pivotB,e=this.equations,g=e[0],h=e[1];f.subtract(g.ni,b.position,a.position),f.normalize(g.ni,g.ni),f.rotate(g.ri,c,a.angle),f.rotate(g.rj,d,b.angle),f.rotate(h.ni,g.ni,Math.PI/2),f.copy(h.ri,g.ri),f.copy(h.rj,g.rj)}},{"./Constraint":7,"./ContactEquation":8,"../math/vec2":27}],22:[function(a,b){function c(a,b){var c=[d.fromValues(-a/2,-b/2),d.fromValues(a/2,-b/2),d.fromValues(a/2,b/2),d.fromValues(-a/2,b/2)];e.call(this,c),this.width=a,this.height=b}var d=a("../math/vec2"),e=(a("./Shape"),a("./Convex"));b.exports=c,c.prototype=new e,c.prototype.computeMomentOfInertia=function(a){var b=this.width,c=this.height;return a*(c*c+b*b)/12}},{"../math/vec2":27,"./Shape":23,"./Convex":9}],25:[function(a,b){function c(a,b,c){c=c||{},this.restLength="number"==typeof c.restLength?c.restLength:1,this.stiffness=c.stiffness||100,this.damping=c.damping||1,this.bodyA=a,this.bodyB=b,this.localAnchorA=d.fromValues(0,0),this.localAnchorB=d.fromValues(0,0),c.localAnchorA&&d.copy(this.localAnchorA,c.localAnchorA),c.localAnchorB&&d.copy(this.localAnchorB,c.localAnchorB),c.worldAnchorA&&this.setWorldAnchorA(c.worldAnchorA),c.worldAnchorB&&this.setWorldAnchorB(c.worldAnchorB)}var d=a("../math/vec2");b.exports=c,c.prototype.setWorldAnchorA=function(a){this.bodyA.toLocalFrame(this.localAnchorA,a)},c.prototype.setWorldAnchorB=function(a){this.bodyB.toLocalFrame(this.localAnchorB,a)},c.prototype.getWorldAnchorA=function(a){this.bodyA.toWorldFrame(a,this.localAnchorA)},c.prototype.getWorldAnchorB=function(a){this.bodyB.toWorldFrame(a,this.localAnchorB)};var e=d.create(),f=d.create(),g=d.create(),h=d.create(),i=d.create(),j=d.create(),k=d.create(),l=d.create(),m=d.create();c.prototype.applyForce=function(){var a=this.stiffness,b=this.damping,c=this.restLength,n=this.bodyA,o=this.bodyB,p=e,q=f,r=g,s=h,t=m,u=i,v=j,w=k,x=l;this.getWorldAnchorA(u),this.getWorldAnchorB(v),d.sub(w,u,n.position),d.sub(x,v,o.position),d.sub(p,v,u);var y=d.len(p);d.normalize(q,p),d.sub(r,o.velocity,n.velocity),d.crossZV(t,o.angularVelocity,x),d.add(r,r,t),d.crossZV(t,n.angularVelocity,w),d.sub(r,r,t),d.scale(s,q,-a*(y-c)-b*d.dot(r,q)),d.sub(n.force,n.force,s),d.add(o.force,o.force,s);var z=d.crossLength(w,s),A=d.crossLength(x,s);n.angularForce-=z,o.angularForce-=A}},{"../math/vec2":27}],26:[function(a,b){function c(){return performance.now?performance.now():performance.webkitNow?performance.webkitNow():(new Date).getTime()}function d(a){o.apply(this),a=a||{},this.springs=[],this.bodies=[],this.solver=a.solver||new e,this.nearphase=new u,this.gravity=a.gravity||g.fromValues(0,-9.78),this.doProfiling=a.doProfiling||!1,this.lastStepTime=0,this.broadphase=a.broadphase||new f,this.constraints=[],this.friction=.1,this.lastTimeStep=1/60,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.addSpringEvent={type:"addSpring",body:null}}var e=a("../solver/GSSolver"),f=a("../collision/NaiveBroadphase"),g=a("../math/vec2"),h=a("../shapes/Circle"),i=a("../shapes/Rectangle"),j=a("../shapes/Convex"),k=a("../shapes/Line"),l=a("../shapes/Plane"),m=a("../shapes/Capsule"),n=a("../shapes/Particle"),o=a("../events/EventEmitter"),p=a("../objects/Body"),q=a("../objects/Spring"),r=a("../constraints/DistanceConstraint"),s=a("../constraints/PointToPointConstraint"),t=a("../../package.json"),u=(a("../collision/Broadphase"),a("../collision/Nearphase"));b.exports=d,d.prototype=new Object(o.prototype),d.prototype.addConstraint=function(a){this.constraints.push(a),a.id=this._constraintIdCounter++},d.prototype.removeConstraint=function(a){var b=this.constraints.indexOf(a);-1!==b&&this.constraints.splice(b,1)},g.create(),g.create(),g.create(),g.create();var v=g.create(),w=g.create(),x=g.fromValues(0,0),y=g.fromValues(0,0),z=g.fromValues(0,0);d.prototype.step=function(a){var b,d,e=this,f=this.doProfiling,o=this.springs.length,p=this.springs,q=this.bodies,r=this.gravity,s=this.solver,t=this.bodies.length,u=this.broadphase,A=this.nearphase,B=this.constraints;this.lastTimeStep=a,f&&(b=c());for(var C=0;C!==t;C++){var D=q[C].force;g.add(D,D,r)}for(var C=0;C!==o;C++){var E=p[C];E.applyForce()}var F=u.getCollisionPairs(this),G=g.length(this.gravity);A.reset();for(var C=0,H=F.length;C!==H;C+=2){var I=F[C],J=F[C+1],K=I.invMass+J.invMass;K>0&&(K=1/K);for(var L=this.friction,M=L*G*K,N=0;N<I.shapes.length;N++)for(var O=I.shapes[N],P=I.shapeOffsets[N]||z,Q=I.shapeAngles[N]||0,R=0;R<J.shapes.length;R++){var S=J.shapes[R],T=J.shapeOffsets[R]||z,U=J.shapeAngles[R]||0;g.rotate(x,P,I.angle),g.rotate(y,T,J.angle),g.add(x,x,I.position),g.add(y,y,J.position);var V=Q+I.angle,W=U+J.angle;A.enableFriction=L>0,A.slipForce=M,O instanceof h?S instanceof h?A.circleCircle(I,O,x,V,J,S,y,W):S instanceof n?A.circleParticle(I,O,x,V,J,S,y,W):S instanceof l?A.circlePlane(I,O,x,V,J,S,y,W):S instanceof i?A.circleConvex(I,O,x,V,J,S,y,W):S instanceof j?A.circleConvex(I,O,x,V,J,S,y,W):S instanceof k&&A.circleLine(I,O,x,V,J,S,y,W):O instanceof n?S instanceof h?A.circleParticle(J,S,y,W,I,O,x,V):S instanceof l?A.particlePlane(I,O,x,V,J,S,y,W):S instanceof i?A.particleConvex(I,O,x,V,J,S,y,W):S instanceof j&&A.particleConvex(I,O,x,V,J,S,y,W):O instanceof l?S instanceof h?A.circlePlane(J,S,y,W,I,O,x,V):S instanceof n?A.particlePlane(J,S,y,W,I,O,x,V):S instanceof i?A.convexPlane(J,S,y,W,I,O,x,V):S instanceof j?A.convexPlane(J,S,y,W,I,O,x,V):S instanceof k?A.planeLine(I,O,x,V,J,S,y,W):S instanceof m&&A.capsulePlane(J,S,y,W,I,O,x,V):O instanceof i?S instanceof l?A.convexPlane(I,O,x,V,J,S,y,W):S instanceof h?A.circleConvex(J,S,y,W,I,O,x,V):S instanceof i?A.convexConvex(J,S,y,W,I,O,x,V):S instanceof n&&A.particleConvex(J,S,y,W,I,O,x,V):O instanceof j?S instanceof l?A.convexPlane(I,O,x,V,J,S,y,W):S instanceof h?A.circleConvex(J,S,y,W,I,O,x,V):S instanceof j?A.convexConvex(I,O,x,V,J,S,y,W):S instanceof n&&A.particleConvex(J,S,y,W,I,O,x,V):O instanceof k?S instanceof h?A.circleLine(J,S,y,W,I,O,x,V):S instanceof l&&A.planeLine(J,S,y,W,I,O,x,V):O instanceof m&&S instanceof l&&A.capsulePlane(I,O,x,V,J,S,y,W)}}for(var C=0,X=A.contactEquations.length;C!==X;C++)s.addEquation(A.contactEquations[C]);for(var C=0,Y=A.frictionEquations.length;C!==Y;C++)s.addEquation(A.frictionEquations[C]);var Z=B.length;for(C=0;C!==Z;C++){var $=B[C];$.update();for(var _=0,ab=$.equations.length;_!==ab;_++){var bb=$.equations[_];s.addEquation(bb)}}s.solve(a,this),s.removeAllEquations();for(var cb=v,db=w,C=0;C!==t;C++){var eb=q[C];if(eb.mass>0){var fb=1/eb.mass,gb=eb.force,hb=eb.position,ib=eb.velocity;eb.angularVelocity+=eb.angularForce*eb.invInertia*a,eb.angle+=eb.angularVelocity*a,g.scale(cb,gb,a*fb),g.add(ib,cb,ib),g.scale(db,ib,a),g.add(hb,hb,db)}}for(var C=0;C!==t;C++){var I=q[C];g.set(I.force,0,0),I.angularForce=0}f&&(d=c(),e.lastStepTime=d-b),this.emit(this.postStepEvent)},d.prototype.addSpring=function(a){this.springs.push(a),this.addSpringEvent.spring=a,this.emit(this.addSpringEvent)},d.prototype.removeSpring=function(a){var b=this.springs.indexOf(a);-1===b&&this.springs.splice(b,1)},d.prototype.addBody=function(a){this.bodies.push(a),this.addBodyEvent.body=a,this.emit(this.addBodyEvent)},d.prototype.removeBody=function(a){var b=this.bodies.indexOf(a);-1!==b&&this.bodies.splice(b,1)},d.prototype.toJSON=function(){function a(a){return[a[0],a[1]]}for(var b={p2:t.version.split(".").slice(0,2).join("."),bodies:[],springs:[],solver:{},gravity:a(this.gravity),broadphase:{},constraints:[]},c=0;c<this.springs.length;c++){var d=this.springs[c];b.springs.push({bodyA:this.bodies.indexOf(d.bodyA),bodyB:this.bodies.indexOf(d.bodyB),stiffness:d.stiffness,damping:d.damping,restLength:d.restLength,localAnchorA:a(d.localAnchorA),localAnchorB:a(d.localAnchorB)})}for(var c=0;c<this.constraints.length;c++){var e=this.constraints[c],f={bodyA:this.bodies.indexOf(e.bodyA),bodyB:this.bodies.indexOf(e.bodyB)};if(e instanceof r)f.type="DistanceConstraint",f.distance=e.distance;else{if(!(e instanceof s))throw new Error("Constraint not supported yet!");f.type="PointToPointConstraint",f.pivotA=a(e.pivotA),f.pivotB=a(e.pivotB),f.maxForce=e.maxForce}b.constraints.push(f)}for(var c=0;c<this.bodies.length;c++){for(var g=this.bodies[c],o=g.shapes,p=[],q=0;q<o.length;q++){var u,d=o[q];if(d instanceof h)u={type:"Circle",radius:d.radius};else if(d instanceof l)u={type:"Plane"};else if(d instanceof n)u={type:"Particle"};else if(d instanceof k)u={type:"Line",length:d.length};else if(d instanceof i)u={type:"Rectangle",width:d.width,height:d.height};else if(d instanceof j){for(var v=[],w=0;w<d.vertices.length;w++)v.push(a(d.vertices[w]));u={type:"Convex",verts:v}}else{if(!(d instanceof m))throw new Error("Shape type not supported yet!");u={type:"Capsule",length:d.length,radius:d.radius}}u.offset=a(g.shapeOffsets[q]||[0,0]),u.angle=g.shapeAngles[q]||0,p.push(u)}b.bodies.push({mass:g.mass,angle:g.angle,position:a(g.position),velocity:a(g.velocity),angularVelocity:g.angularVelocity,force:a(g.force),shapes:p})}return b},d.prototype.fromJSON=function(a){if(this.clear(),!a.p2)return!1;switch(a.p2){case"0.1":g.copy(this.gravity,a.gravity);for(var b=0;b<a.bodies.length;b++){for(var c=a.bodies[b],d=c.shapes,e=new p({mass:c.mass,position:c.position,angle:c.angle,velocity:c.velocity,angularVelocity:c.angularVelocity,force:c.force}),f=0;f<d.length;f++){var o,t=d[f];switch(t.type){case"Circle":o=new h(t.radius);break;case"Plane":o=new l;break;case"Particle":o=new n;break;case"Line":o=new k(t.length);break;case"Rectangle":o=new i(t.width,t.height);break;case"Convex":o=new j(t.verts);break;case"Capsule":o=new m(t.length,t.radius);break;default:throw new Error("Shape type not supported: "+t.type)}e.addShape(o,t.offset,t.angle)}this.addBody(e)}for(var b=0;b<a.springs.length;b++){var t=a.springs[b],u=new q(this.bodies[t.bodyA],this.bodies[t.bodyB],{stiffness:t.stiffness,damping:t.damping,restLength:t.restLength,localAnchorA:t.localAnchorA,localAnchorB:t.localAnchorB});this.addSpring(u)}for(var b=0;b<a.constraints.length;b++){var v,w=a.constraints[b];switch(w.type){case"DistanceConstraint":v=new r(this.bodies[w.bodyA],this.bodies[w.bodyB],w.distance);
break;case"PointToPointConstraint":v=new s(this.bodies[w.bodyA],w.pivotA,this.bodies[w.bodyB],w.pivotB,w.maxForce);break;default:throw new Error("Constraint type not recognized: "+w.type)}this.addConstraint(v)}break;default:return!1}return!0},d.prototype.clear=function(){for(var a=this.constraints,b=a.length-1;b>=0;b--)this.removeConstraint(a[b]);for(var c=this.bodies,b=c.length-1;b>=0;b--)this.removeBody(c[b]);for(var d=this.springs,b=d.length-1;b>=0;b--)this.removeSpring(d[b])}},{"../../package.json":2,"../solver/GSSolver":15,"../collision/NaiveBroadphase":18,"../math/vec2":27,"../shapes/Circle":6,"../shapes/Rectangle":22,"../shapes/Convex":9,"../shapes/Line":17,"../shapes/Plane":20,"../shapes/Capsule":5,"../shapes/Particle":19,"../events/EventEmitter":12,"../objects/Body":3,"../objects/Spring":25,"../constraints/DistanceConstraint":10,"../constraints/PointToPointConstraint":21,"../collision/Broadphase":4,"../collision/Nearphase":28}],27:[function(a,b){var c=a("../../node_modules/gl-matrix/src/gl-matrix/vec2").vec2;c.getX=function(a){return a[0]},c.getY=function(a){return a[1]},c.crossLength=function(a,b){return a[0]*b[1]-a[1]*b[0]},c.crossVZ=function(a,b,d){return c.rotate(a,b,-Math.PI/2),c.scale(a,a,d),a},c.crossZV=function(a,b,d){return c.rotate(a,d,Math.PI/2),c.scale(a,a,b),a},c.rotate=function(a,b,c){var d=Math.cos(c),e=Math.sin(c),f=b[0],g=b[1];a[0]=d*f-e*g,a[1]=e*f+d*g},c.toLocalFrame=function(a,b,d,e){c.copy(a,b),c.sub(a,a,d),c.rotate(a,a,-e)},c.toGlobalFrame=function(a,b,d,e){c.copy(a,b),c.rotate(a,a,e),c.add(a,a,d)},c.centroid=function(a,b,d,e){return c.add(a,b,d),c.add(a,a,e),c.scale(a,a,1/3),a},b.exports=c},{"../../node_modules/gl-matrix/src/gl-matrix/vec2":31}],29:[function(a,b){var c={};c.IsSimple=function(a){var b=a.length>>1;if(4>b)return!0;for(var d=new c._P,e=new c._P,f=new c._P,g=new c._P,h=new c._P,i=0;b>i;i++){d.x=a[2*i],d.y=a[2*i+1],i==b-1?(e.x=a[0],e.y=a[1]):(e.x=a[2*i+2],e.y=a[2*i+3]);for(var j=0;b>j;j++)if(!(Math.abs(i-j)<2||j==b-1&&0==i||i==b-1&&0==j||(f.x=a[2*j],f.y=a[2*j+1],j==b-1?(g.x=a[0],g.y=a[1]):(g.x=a[2*j+2],g.y=a[2*j+3]),null==c._GetLineIntersection(d,e,f,g,h))))return!1}return!0},c.IsConvex=function(a){if(a.length<6)return!0;for(var b=a.length-4,d=0;b>d;d+=2)if(!c._convex(a[d],a[d+1],a[d+2],a[d+3],a[d+4],a[d+5]))return!1;return c._convex(a[b],a[b+1],a[b+2],a[b+3],a[0],a[1])?c._convex(a[b+2],a[b+3],a[0],a[1],a[2],a[3])?!0:!1:!1},c.GetArea=function(a){if(a.length<6)return 0;for(var b=a.length-2,c=0,d=0;b>d;d+=2)c+=(a[d+2]-a[d])*(a[d+1]+a[d+3]);return c+=(a[0]-a[b])*(a[b+1]+a[1]),.5*-c},c.GetAABB=function(a){for(var b=1/0,c=1/0,d=-b,e=-c,f=0;f<a.length;f+=2)b=Math.min(b,a[f]),d=Math.max(d,a[f]),c=Math.min(c,a[f+1]),e=Math.max(e,a[f+1]);return{x:b,y:c,width:d-b,height:e-c}},c.Triangulate=function(a){var b=a.length>>1;if(3>b)return[];for(var d=[],e=[],f=0;b>f;f++)e.push(f);for(var f=0,g=b;g>3;){var h=e[(f+0)%g],i=e[(f+1)%g],j=e[(f+2)%g],k=a[2*h],l=a[2*h+1],m=a[2*i],n=a[2*i+1],o=a[2*j],p=a[2*j+1],q=!1;if(c._convex(k,l,m,n,o,p)){q=!0;for(var r=0;g>r;r++){var s=e[r];if(s!=h&&s!=i&&s!=j&&c._PointInTriangle(a[2*s],a[2*s+1],k,l,m,n,o,p)){q=!1;break}}}if(q)d.push(h,i,j),e.splice((f+1)%g,1),g--,f=0;else if(f++>3*g)break}return d.push(e[0],e[1],e[2]),d},c.ContainsPoint=function(a,b,c){for(var d,e,f=a.length>>1,g=a[2*f-2]-b,h=a[2*f-1]-c,i=0,j=0;f>j;j++)if(d=g,e=h,g=a[2*j]-b,h=a[2*j+1]-c,!(0>e&&0>h||e>=0&&h>=0||0>d&&0>g)){var k=d+(g-d)*-e/(h-e);k>0&&i++}return 1==(1&i)},c.Slice=function(a,b,d,e,f){if(c.ContainsPoint(a,b,d)||c.ContainsPoint(a,e,f))return[a.slice(0)];for(var g=new c._P(b,d),h=new c._P(e,f),i=[],j=[],k=0;k<a.length;k+=2)j.push(new c._P(a[k],a[k+1]));for(var k=0;k<j.length;k++){var l=new c._P(0,0);l=c._GetLineIntersection(g,h,j[k],j[(k+1)%j.length],l),l&&(l.flag=!0,i.push(l),j.splice(k+1,0,l),k++)}if(0==i.length)return[a.slice(0)];var m=function(a,b){return c._P.dist(g,a)-c._P.dist(g,b)};i.sort(m);for(var n=[],o=0;i.length>0;){j.length;var p=i[0],q=i[1],r=j.indexOf(p),s=j.indexOf(q),t=!1;if(c._firstWithFlag(j,r)==s?t=!0:(p=i[1],q=i[0],r=j.indexOf(p),s=j.indexOf(q),c._firstWithFlag(j,r)==s&&(t=!0)),t){o--;var u=c._getPoints(j,r,s);n.push(u),j=c._getPoints(j,s,r),p.flag=q.flag=!1,i.splice(0,2),0==i.length&&n.push(j)}else o++,i.reverse();if(o>1)break}for(var v=[],k=0;k<n.length;k++){for(var w=n[k],x=[],y=0;y<w.length;y++)x.push(w[y].x,w[y].y);v.push(x)}return v},c.Raycast=function(a,b,d,e,f,g){var h=a.length-2,i=c._tp,j=i[0],k=i[1],l=i[2],m=i[3],n=i[4];j.x=b,j.y=d,k.x=b+e,k.y=d+f,null==g&&(g={dist:0,edge:0,norm:{x:0,y:0},refl:{x:0,y:0}}),g.dist=1/0;for(var o=0;h>o;o+=2){l.x=a[o],l.y=a[o+1],m.x=a[o+2],m.y=a[o+3];var p=c._RayLineIntersection(j,k,l,m,n);p&&c._updateISC(e,f,j,l,m,n,o/2,g)}l.x=m.x,l.y=m.y,m.x=a[0],m.y=a[1];var p=c._RayLineIntersection(j,k,l,m,n);return p&&c._updateISC(e,f,j,l,m,n,a.length/2,g),1/0!=g.dist?g:null},c.ClosestEdge=function(a,b,d,e){var f=a.length-2,g=c._tp,h=g[0],i=g[2],j=g[3];g[4],h.x=b,h.y=d,null==e&&(e={dist:0,edge:0,point:{x:0,y:0},norm:{x:0,y:0}}),e.dist=1/0;for(var k=0;f>k;k+=2)i.x=a[k],i.y=a[k+1],j.x=a[k+2],j.y=a[k+3],c._pointLineDist(h,i,j,k>>1,e);i.x=j.x,i.y=j.y,j.x=a[0],j.y=a[1],c._pointLineDist(h,i,j,f>>1,e);var l=1/e.dist;return e.norm.x=(b-e.point.x)*l,e.norm.y=(d-e.point.y)*l,e},c._pointLineDist=function(a,b,c,d,e){var f,g,h=a.x,i=a.y,j=b.x,k=b.y,l=c.x,m=c.y,n=h-j,o=i-k,p=l-j,q=m-k,r=n*p+o*q,s=p*p+q*q,t=r/s;0>t||j==l&&k==m?(f=j,g=k):t>1?(f=l,g=m):(f=j+t*p,g=k+t*q);var u=h-f,v=i-g,w=Math.sqrt(u*u+v*v);w<e.dist&&(e.dist=w,e.edge=d,e.point.x=f,e.point.y=g)},c._updateISC=function(a,b,d,e,f,g,h,i){var j=c._P.dist(d,g);if(j<i.dist){var k=1/c._P.dist(e,f),l=-(f.y-e.y)*k,m=(f.x-e.x)*k,n=2*(a*l+b*m);i.dist=j,i.norm.x=l,i.norm.y=m,i.refl.x=-n*l+a,i.refl.y=-n*m+b,i.edge=h}},c._getPoints=function(a,b,c){var d=a.length,e=[];b>c&&(c+=d);for(var f=b;c>=f;f++)e.push(a[f%d]);return e},c._firstWithFlag=function(a,b){for(var c=a.length;;)if(b=(b+1)%c,a[b].flag)return b},c._PointInTriangle=function(a,b,c,d,e,f,g,h){var i=g-c,j=h-d,k=e-c,l=f-d,m=a-c,n=b-d,o=i*i+j*j,p=i*k+j*l,q=i*m+j*n,r=k*k+l*l,s=k*m+l*n,t=1/(o*r-p*p),u=(r*q-p*s)*t,v=(o*s-p*q)*t;return u>=0&&v>=0&&1>u+v},c._RayLineIntersection=function(a,b,d,e,f){var g=a.x-b.x,h=d.x-e.x,i=a.y-b.y,j=d.y-e.y,k=g*j-i*h;if(0==k)return null;var l=a.x*b.y-a.y*b.x,m=d.x*e.y-d.y*e.x,n=f,o=1/k;return n.x=(l*h-g*m)*o,n.y=(l*j-i*m)*o,c._InRect(n,d,e)?i>0&&n.y>a.y||0>i&&n.y<a.y?null:g>0&&n.x>a.x||0>g&&n.x<a.x?null:n:null},c._GetLineIntersection=function(a,b,d,e,f){var g=a.x-b.x,h=d.x-e.x,i=a.y-b.y,j=d.y-e.y,k=g*j-i*h;if(0==k)return null;var l=a.x*b.y-a.y*b.x,m=d.x*e.y-d.y*e.x,n=f;return n.x=(l*h-g*m)/k,n.y=(l*j-i*m)/k,c._InRect(n,a,b)&&c._InRect(n,d,e)?n:null},c._InRect=function(a,b,c){return b.x==c.x?a.y>=Math.min(b.y,c.y)&&a.y<=Math.max(b.y,c.y):b.y==c.y?a.x>=Math.min(b.x,c.x)&&a.x<=Math.max(b.x,c.x):a.x>=Math.min(b.x,c.x)&&a.x<=Math.max(b.x,c.x)&&a.y>=Math.min(b.y,c.y)&&a.y<=Math.max(b.y,c.y)?!0:!1},c._convex=function(a,b,c,d,e,f){return(b-d)*(e-c)+(c-a)*(f-d)>=0},c._P=function(a,b){this.x=a,this.y=b,this.flag=!1},c._P.prototype.toString=function(){return"Point ["+this.x+", "+this.y+"]"},c._P.dist=function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},c._tp=[];for(var d=0;10>d;d++)c._tp.push(new c._P(0,0));b.exports=c},{}],30:[function(a,b){function c(){this.equations=[],this.bodies=[]}b.exports=c,c.prototype.reset=function(){this.equations.length=this.bodies.length=0},c.prototype.getBodies=function(){for(var a=[],b=[],c=this.equations,d=0;d!==c.length;d++){var e=c[d];-1===b.indexOf(e.bi.id)&&(a.push(e.bi),b.push(e.bi.id)),-1===b.indexOf(e.bj.id)&&(a.push(e.bj),b.push(e.bj.id))}return a},c.prototype.solve=function(a,b){var c=[];b.removeAllEquations();for(var d=this.equations.length,e=0;e!==d;e++)b.addEquation(this.equations[e]);for(var f=this.getBodies(),g=f.length,e=0;e!==g;e++)c.push(f[e]);b.solve(a,{bodies:c})}},{}],31:[function(a,b,c){var d={};if(!e)var e=1e-6;d.create=function(){return new Float32Array(2)},d.clone=function(a){var b=new Float32Array(2);return b[0]=a[0],b[1]=a[1],b},d.fromValues=function(a,b){var c=new Float32Array(2);return c[0]=a,c[1]=b,c},d.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},d.set=function(a,b,c){return a[0]=b,a[1]=c,a},d.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},d.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},d.sub=d.subtract,d.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},d.mul=d.multiply,d.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},d.div=d.divide,d.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},d.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},d.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},d.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},d.dist=d.distance,d.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},d.sqrDist=d.squaredDistance,d.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},d.len=d.length,d.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},d.sqrLen=d.squaredLength,d.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},d.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},d.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},d.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},d.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},d.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=d*c[0]+e*c[1],a[1]=d*c[2]+e*c[3],a},d.forEach=function(){var a=new Float32Array(2);return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),d.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},"undefined"!=typeof c&&(c.vec2=d)},{}],28:[function(a,b){function c(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.slipForce=10,this.reuseObjects=!0,this.reusableContactEquations=[],this.reusableFrictionEquations=[]}var d=a("../math/vec2"),e=a("../constraints/ContactEquation"),f=a("../constraints/FrictionEquation"),g=a("../shapes/Circle");b.exports=c;var h=d.fromValues(0,1),i=d.fromValues(0,0),j=d.fromValues(0,0),k=d.fromValues(0,0),l=d.fromValues(0,0),m=d.fromValues(0,0),n=d.fromValues(0,0),o=d.fromValues(0,0),p=d.fromValues(0,0),q=d.fromValues(0,0),r=d.fromValues(0,0),s=d.fromValues(0,0),t=d.fromValues(0,0),u=d.fromValues(0,0);d.fromValues(0,0),d.fromValues(0,0),c.prototype.reset=function(){if(this.reuseObjects){for(var a=this.contactEquations,b=this.frictionEquations,c=this.reusableFrictionEquations,d=this.reusableContactEquations,e=0,f=a.length;e!==f;e++)d.push(a[e]);for(var e=0,f=b.length;e!==f;e++)c.push(b[e])}this.contactEquations.length=this.frictionEquations.length=0},c.prototype.createContactEquation=function(a,b){var c=this.reusableContactEquations.length?this.reusableContactEquations.pop():new e(a,b);return c.bi=a,c.bj=b,c},c.prototype.createFrictionEquation=function(a,b){var c=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new f(a,b);return c.bi=a,c.bj=b,c.setSlipForce(this.slipForce),c},c.prototype.createFrictionFromContact=function(a){var b=this.createFrictionEquation(a.bi,a.bj);return d.copy(b.ri,a.ri),d.copy(b.rj,a.rj),d.rotate(b.t,a.ni,-Math.PI/2),b},c.prototype.planeLine=function(a,b,c,e,f,g,r,s){var t=g,u=s,v=f,w=r,x=c,y=e,z=a,A=i,B=j,C=k,D=l,E=m,F=n,G=o,H=p,I=q;d.set(A,-t.length/2,0),d.set(B,t.length/2,0),d.rotate(C,A,u),d.rotate(D,B,u),d.add(C,C,w),d.add(D,D,w),d.copy(A,C),d.copy(B,D),d.sub(E,B,A),d.normalize(F,E),d.rotate(I,F,-Math.PI/2),d.rotate(H,h,y);for(var J=[A,B],K=0;K<J.length;K++){var L=J[K];d.sub(G,L,x);var M=d.dot(G,H);if(0>M){var N=this.createContactEquation(z,v);d.copy(N.ni,H),d.normalize(N.ni,N.ni),d.scale(G,H,M),d.sub(N.ri,L,G),d.sub(N.ri,N.ri,z.position),d.sub(N.rj,L,w),d.add(N.rj,N.rj,w),d.sub(N.rj,N.rj,v.position),this.contactEquations.push(N),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(N))}}},c.prototype.circleLine=function(a,b,c,e,f,g,h,j){var v=g,w=j,x=f,y=h,z=c,A=a,B=b,C=i,D=k,E=l,F=m,G=n,H=o,I=p,J=q,K=r,L=s,M=t,N=u;d.set(I,-v.length/2,0),d.set(J,v.length/2,0),d.rotate(K,I,w),d.rotate(L,J,w),d.add(K,K,y),d.add(L,L,y),d.copy(I,K),d.copy(J,L),d.sub(G,J,I),d.normalize(H,G),d.rotate(F,H,-Math.PI/2),d.sub(M,z,I);var O=d.dot(M,F);if(d.sub(E,I,y),d.sub(N,z,y),Math.abs(O)<B.radius){d.scale(C,F,O),d.sub(D,z,C);var P=d.dot(H,D),Q=d.dot(H,I),R=d.dot(H,J);if(P>Q&&R>P){var S=this.createContactEquation(A,x);d.scale(S.ni,C,-1),d.normalize(S.ni,S.ni),d.scale(S.ri,S.ni,B.radius),d.add(S.ri,S.ri,z),d.sub(S.ri,S.ri,A.position),d.sub(S.rj,D,y),d.add(S.rj,S.rj,y),d.sub(S.rj,S.rj,x.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S))}}for(var T=[I,J],U=0;U<T.length;U++){var V=T[U];if(d.sub(M,V,z),d.squaredLength(M)<B.radius*B.radius){var S=this.createContactEquation(A,x);d.copy(S.ni,M),d.normalize(S.ni,S.ni),d.scale(S.ri,S.ni,B.radius),d.add(S.ri,S.ri,z),d.sub(S.ri,S.ri,A.position),d.sub(S.rj,V,y),d.add(S.rj,S.rj,y),d.sub(S.rj,S.rj,x.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S))}}},c.prototype.circleConvex=function(a,b,c,e,f,g,h,t){var u=g,v=t,w=f,x=h,y=c,z=a,A=b,B=i,C=j,D=k,E=l,F=m,G=n,H=o,I=p,J=q,K=r,L=s;verts=u.vertices;for(var M=0;M<verts.length;M++){var N=verts[M],O=verts[(M+1)%verts.length];d.rotate(B,N,v),d.rotate(C,O,v),d.add(B,B,x),d.add(C,C,x),d.sub(D,C,B),d.normalize(E,D),d.rotate(F,E,-Math.PI/2),d.sub(K,y,B);var P=d.dot(K,F);if(d.sub(G,B,x),d.sub(H,y,x),P<A.radius&&d.dot(G,H)>0){d.scale(I,F,P),d.sub(J,y,I);var Q=d.dot(E,J),R=d.dot(E,B),S=d.dot(E,C);if(Q>R&&S>Q){var T=this.createContactEquation(z,w);return d.scale(T.ni,I,-1),d.normalize(T.ni,T.ni),d.scale(T.ri,T.ni,A.radius),d.add(T.ri,T.ri,y),d.sub(T.ri,T.ri,z.position),d.sub(T.rj,J,x),d.add(T.rj,T.rj,x),d.sub(T.rj,T.rj,w.position),this.contactEquations.push(T),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(T)),!0}}}for(var M=0;M<verts.length;M++){var U=verts[M];if(d.rotate(L,U,v),d.add(L,L,x),d.sub(K,L,y),d.squaredLength(K)<A.radius*A.radius){var T=this.createContactEquation(z,w);return d.copy(T.ni,K),d.normalize(T.ni,T.ni),d.scale(T.ri,T.ni,A.radius),d.add(T.ri,T.ri,y),d.sub(T.ri,T.ri,z.position),d.sub(T.rj,L,x),d.add(T.rj,T.rj,x),d.sub(T.rj,T.rj,w.position),this.contactEquations.push(T),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(T)),!0}}return!1},c.prototype.particleConvex=function(a,b,c,e,f,g,h,s){var t=g,u=s,v=f,w=h,x=c,y=a,z=i,A=j,B=k,C=l,D=m,E=n,F=o,G=p,H=q,I=r;verts=t.vertices;for(var J=0;J<verts.length;J++){var K=verts[J],L=verts[(J+1)%verts.length];d.rotate(z,K,u),d.rotate(A,L,u),d.add(z,z,w),d.add(A,A,w),d.sub(B,A,z),d.normalize(C,B),d.rotate(D,C,-Math.PI/2),d.sub(I,x,z);var M=d.dot(I,D);if(d.sub(E,z,w),d.sub(F,x,w),0>M&&d.dot(E,F)>0){d.scale(G,D,M),d.sub(H,x,G);var N=d.dot(C,H),O=d.dot(C,z),P=d.dot(C,A);if(N>O&&P>N){var Q=this.createContactEquation(y,v);return d.copy(Q.ni,G),d.normalize(Q.ni,Q.ni),d.set(Q.ri,0,0),d.add(Q.ri,Q.ri,x),d.sub(Q.ri,Q.ri,y.position),d.sub(Q.rj,H,w),d.add(Q.rj,Q.rj,w),d.sub(Q.rj,Q.rj,v.position),this.contactEquations.push(Q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Q)),!0}}}return!1},c.prototype.circleCircle=function(a,b,c,e,f,g,h){var i=a,j=b,k=c,l=f,m=g,n=h,o=this.createContactEquation(i,l);d.sub(o.ni,n,k),d.normalize(o.ni,o.ni),d.scale(o.ri,o.ni,j.radius),d.scale(o.rj,o.ni,-m.radius),d.add(o.ri,o.ri,k),d.sub(o.ri,o.ri,i.position),d.add(o.rj,o.rj,n),d.sub(o.rj,o.rj,l.position),this.contactEquations.push(o),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(o))},c.prototype.convexPlane=function(a,b,c,e,f,g,l,m){var n=a,o=c,p=e,q=f,r=l,s=m,t=i,u=j,v=k,w=0;d.rotate(u,h,s);for(var x=0;x<b.vertices.length;x++){var y=b.vertices[x];if(d.rotate(t,y,p),d.add(t,t,o),d.sub(v,t,r),d.dot(v,u)<0){w++;var z=this.createContactEquation(q,n);d.sub(v,t,r),d.copy(z.ni,u);var A=d.dot(v,z.ni);if(d.scale(v,z.ni,A),d.sub(z.rj,t,n.position),d.sub(z.ri,t,v),d.sub(z.ri,z.ri,q.position),this.contactEquations.push(z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(z)),w>=2)break}}return w>0},c.prototype.particlePlane=function(a,b,c,e,f,g,j,k){var l=a,m=c,n=f,o=j,p=k,q=i;p=p||0;var r=this.createContactEquation(n,l);d.sub(q,m,o),d.rotate(r.ni,h,p);var s=d.dot(q,r.ni);return s>0?!1:(d.scale(q,r.ni,s),d.sub(r.ri,m,q),d.sub(r.ri,r.ri,n.position),d.sub(r.rj,m,l.position),this.contactEquations.push(r),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(r)),!0)},c.prototype.circleParticle=function(a,b,c,e,f,g,h){var j=a,k=b,l=c,m=f,n=h,o=i,p=this.createContactEquation(j,m);return d.sub(o,n,l),d.squaredLength(o)>k.radius?!1:(d.copy(p.ni,o),d.normalize(p.ni,p.ni),d.scale(p.ri,p.ni,k.radius),d.add(p.ri,p.ri,l),d.sub(p.ri,p.ri,j.position),d.sub(p.rj,n,m.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),!0)};{var v=new g(1),w=d.create(),x=d.create();d.create()}c.prototype.capsulePlane=function(a,b,c,e,f,g,h,i){var j=w,k=x,l=v;d.set(j,-b.length/2,0),d.rotate(j,j,e),d.add(j,j,c),d.set(k,b.length/2,0),d.rotate(k,k,e),d.add(k,k,c),l.radius=b.radius,this.circlePlane(a,l,j,0,f,g,h,i),this.circlePlane(a,l,k,0,f,g,h,i)},c.prototype.circlePlane=function(a,b,c,e,f,g,l,m){var n=a,o=b,p=c,q=f,r=l,s=m;s=s||0;var t=i,u=j,v=k;d.sub(t,p,r),d.rotate(u,h,s);var w=d.dot(u,t);if(w>o.radius)return!1;var x=this.createContactEquation(q,n);return d.copy(x.ni,u),d.scale(x.rj,x.ni,-o.radius),d.add(x.rj,x.rj,p),d.sub(x.rj,x.rj,n.position),d.scale(v,x.ni,w),d.sub(x.ri,t,v),d.add(x.ri,x.ri,r),d.sub(x.ri,x.ri,q.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x)),!0},c.prototype.convexConvex=function(a,b,e,f,g,h,n,r){var s=i,t=j,u=k,v=l,w=m,x=o,y=p,z=q,A=c.findSeparatingAxis(b,e,f,h,n,r,s);if(!A)return!1;d.sub(y,n,e),d.dot(s,y)>0&&d.scale(s,s,-1);var B=c.getClosestEdge(b,f,s,!0),C=c.getClosestEdge(h,r,s);if(-1==B||-1==C)return!1;for(var D=0;2>D;D++){var E=B,F=C,G=b,H=h,I=e,J=n,K=f,L=r,M=a,N=g;if(0==D){var O;O=E,E=F,F=O,O=G,G=H,H=O,O=I,I=J,J=O,O=K,K=L,L=O,O=M,M=N,N=O}for(var P=F;F+2>P;P++){var Q=H.vertices[(P+H.vertices.length)%H.vertices.length];d.rotate(t,Q,L),d.add(t,t,J);for(var R=0,S=E-1;E+2>S;S++){var T=G.vertices[(S+G.vertices.length)%G.vertices.length],U=G.vertices[(S+1+G.vertices.length)%G.vertices.length];d.rotate(u,T,K),d.rotate(v,U,K),d.add(u,u,I),d.add(v,v,I),d.sub(w,v,u),d.rotate(z,w,-Math.PI/2),d.normalize(z,z),d.sub(y,t,u);var V=d.dot(z,y);0>V&&R++}if(3==R){var W=this.createContactEquation(M,N),T=G.vertices[E%G.vertices.length],U=G.vertices[(E+1)%G.vertices.length];d.rotate(u,T,K),d.rotate(v,U,K),d.add(u,u,I),d.add(v,v,I),d.sub(w,v,u),d.rotate(W.ni,w,-Math.PI/2),d.normalize(W.ni,W.ni),d.sub(y,t,u);var V=d.dot(W.ni,y);d.scale(x,W.ni,V),d.sub(W.ri,t,I),d.sub(W.ri,W.ri,x),d.add(W.ri,W.ri,I),d.sub(W.ri,W.ri,M.position),d.sub(W.rj,t,J),d.add(W.rj,W.rj,J),d.sub(W.rj,W.rj,N.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W))}}}};var y=d.fromValues(0,0);c.projectConvexOntoAxis=function(a,b,c,e,f){var g,h,i=null,j=null,k=y;d.rotate(k,e,-c);for(var l=0;l<a.vertices.length;l++)g=a.vertices[l],h=d.dot(g,k),(null===i||h>i)&&(i=h),(null===j||j>h)&&(j=h);if(j>i){var m=j;j=i,i=m}var n=d.dot(b,e);d.set(f,j+n,i+n)};var z=d.fromValues(0,0),A=d.fromValues(0,0),B=d.fromValues(0,0),C=d.fromValues(0,0),D=d.fromValues(0,0),E=d.fromValues(0,0);c.findSeparatingAxis=function(a,b,e,f,g,h,i){for(var j=null,k=!1,l=!1,m=z,n=A,o=B,p=C,q=D,r=E,s=0;2>s;s++){var t=a,u=e;1==s&&(t=f,u=h);for(var v=0;v<t.vertices.length;v++){d.rotate(n,t.vertices[v],u),d.rotate(o,t.vertices[(v+1)%t.vertices.length],u),d.sub(m,o,n),d.rotate(p,m,-Math.PI/2),d.normalize(p,p),c.projectConvexOntoAxis(a,b,e,p,q),c.projectConvexOntoAxis(f,g,h,p,r);var w=q,x=r,y=!1;q[0]>r[0]&&(x=q,w=r,y=!0);var F=x[0]-w[1];k=0>F,(null===j||F>j)&&(d.copy(i,p),j=F,l=k)}}return l};var F=d.fromValues(0,0),G=d.fromValues(0,0),H=d.fromValues(0,0);c.getClosestEdge=function(a,b,c,e){var f=F,g=G,h=H;d.rotate(f,c,-b),e&&d.scale(f,f,-1);for(var i=-1,j=0;j<a.vertices.length;j++){d.subtract(g,a.vertices[(j+1)%a.vertices.length],a.vertices[j%a.vertices.length]),d.rotate(h,g,-Math.PI/2),d.normalize(h,h);var k=d.dot(h,f);(-1==i||k>maxDot)&&(i=j%a.vertices.length,maxDot=k)}return i}},{"../math/vec2":27,"../constraints/ContactEquation":8,"../constraints/FrictionEquation":13,"../shapes/Circle":6}]},{},[1])(1)});