<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8" />
	<title>Pixi Animation</title>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<style>
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
			background: #333333;
		}
		#info {
			left: 10px;
			top: 10px;
			width: 100%;
			position:absolute;
			display:block;
			color : #cccccc; 
			font-size:12px;
			font-weight: bold;
			font-family: 'Segoe UI';
		}
		h3 { display:inline; }
		a { color:#ff9933; text-decoration:none; }
	</style>
	
</head>
<body>
	<div id="content"></div>
	<div id="info"> <h3><a href="anim.html">DIV anim</a></h3> vs <h3><a href="anim_canvas.html">CANVAS anim</a></h3> vs <h3><a href="anim_webgl.html">WEBGL anim</a></h3> vs <h3><a href="anim_pixi.html" style="color:#3399FF">PIXI anim</a></h3></div>
	<div id="ribbon" style="position: absolute; top: 0; right: 0; border: 0;">
		<a href="https://github.com/lo-th/crossed"><img  src="http://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub" /></a>
	</div>
	<script src="js/pixi.js"></script>
	<script type="text/javascript">
		var t = [], tmax;
		var bg = [], bgmax;
		var content, stage, renderer;
		var SCALE = 4; // resolution multiplier

		window.onload = init;

		function init() {
			stage = new PIXI.Stage(0x333333, true);
			renderer = PIXI.autoDetectRenderer(256*SCALE, 128*SCALE, null);
			content = document.getElementById('content');

			content.appendChild(renderer.view);
			renderer.view.style.position = "absolute";
			renderer.view.style.top = "40px";
			renderer.view.style.left = "10px";
			renderer.view.style.width = window.innerWidth-20+"px";
		
			bg[0] = new SpriteAnim({ w: 256, h: 128, frames: 0, sprite: "img/bg-1.png", speed : 1 });
			bg[1] = new SpriteAnim({ w: 256, h: 128, frames: 0, sprite: "img/bg-2.png", speed : 2 });
			bg[2] = new SpriteAnim({ w: 256, h: 128, frames: 0, sprite: "img/bg-3.png", speed : 3 });
			
			var posy = 38;
			for(var i=0; i<60; i++){
				posy+=0.5;
				t[i] = new SpriteAnim({ x:rand(0, 200), y:posy, w: 64, h: 64, frames: 16, sprite: "img/anim-"+(Math.floor(Math.random()*4)) +".png", elementId : "anim", speed : 1, scale: (0.4+((posy-38)/50)) });
			}
			bg[3] = new SpriteAnim({ w: 256, h: 128, frames: 0, sprite: "img/bg-4.png", speed : 4 });
			bgmax = bg.length;
			tmax = t.length;

			window.addEventListener("resize", resize, false);
			requestAnimFrame( animate );
	    }

		function animate() {
		    requestAnimFrame( animate );

			var i;
			for(i=0; i<bgmax; i++){
				bg[i].update();
			}
			for(i=0; i<tmax; i++){
				t[i].update();
			}
		    renderer.render(stage);

		}

		function SpriteAnim(options) {
			this.x = options.x || 0;
		  	this.y = options.y || 0;
		  	this.scale = options.scale || 1;
		  	this.w = options.w;
		  	this.h = options.h;
		  	this.frames = options.frames ;
		  	this.n = rand(0, this.frames);
		  	var texture = PIXI.Texture.fromImage(options.sprite);
		  	
			this.tiling = new PIXI.TilingSprite(texture, (this.w*this.scale)*SCALE, (this.h*this.scale)*SCALE);
			this.tiling.position.x = this.x*SCALE;
		  	this.tiling.position.y = this.y*SCALE;
			this.speed = options.speed;
			
			this.tiling.tileScale.x = SCALE*this.scale;
			this.tiling.tileScale.y = SCALE*this.scale;

			stage.addChild(this.tiling);

			this.update = function () {
				if(this.frames!=0){
					if (this.n >= this.frames) { this.n = 0; }
					this.tiling.tilePosition.x = (this.w*this.n);
					this.n ++;
				} else{
					this.tiling.tilePosition.x -= this.speed;
			    }
			}
		}

		function resize() {
			renderer.view.style.width = window.innerWidth-20+"px";
		}

		function rand(min, max) { return (Math.random()*(max-min))+min; };

	</script>

	</body>
</html>
