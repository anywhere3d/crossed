/**
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013 p2.js authors
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(a){if("function"==typeof bootstrap)bootstrap("p2",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeP2=a}else"undefined"!=typeof window?window.p2=a():self.p2=a()}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d={};if(!e)var e=1e-6;d.create=function(){return new Float32Array(2)},d.clone=function(a){var b=new Float32Array(2);return b[0]=a[0],b[1]=a[1],b},d.fromValues=function(a,b){var c=new Float32Array(2);return c[0]=a,c[1]=b,c},d.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},d.set=function(a,b,c){return a[0]=b,a[1]=c,a},d.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},d.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},d.sub=d.subtract,d.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},d.mul=d.multiply,d.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},d.div=d.divide,d.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},d.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},d.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},d.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},d.dist=d.distance,d.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},d.sqrDist=d.squaredDistance,d.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},d.len=d.length,d.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},d.sqrLen=d.squaredLength,d.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},d.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},d.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},d.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},d.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},d.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=d*c[0]+e*c[1],a[1]=d*c[2]+e*c[3],a},d.forEach=function(){var a=new Float32Array(2);return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),d.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},"undefined"!=typeof c&&(c.vec2=d)},{}],2:[function(a,b){b.exports={name:"p2",version:"0.1.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./build/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest",nodeunit:"latest",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"*","grunt-browserify":"*","gl-matrix":"2.0.0"},dependencies:{}}},{}],3:[function(a,b,c){function d(a,b,c,d){o.sub(r,b,d);var e=a.radius,f=c.radius;return o.sqrLen(r)<(e+f)*(e+f)}function e(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var r=a,s=b,t=c,u=e,v=f,w=g,x=j.length?j.pop():new p(r,u);if(x.bi=r,x.bj=u,o.sub(x.ni,w,t),o.normalize(x.ni,x.ni),o.scale(x.ri,x.ni,s.radius),o.scale(x.rj,x.ni,-v.radius),o.add(x.ri,x.ri,t),o.sub(x.ri,x.ri,r.position),o.add(x.rj,x.rj,w),o.sub(x.rj,x.rj,u.position),i.push(x),k){var y=m.length?m.pop():new q(r,u);y.bi=r,y.bj=u,y.setSlipForce(n),o.copy(y.ri,x.ri),o.copy(y.rj,x.rj),o.rotate(y.t,x.ni,-Math.PI/2),l.push(y)}}function f(a,b,c,d,e){return e=e||0,o.sub(r,b,d),o.rotate(s,t,e),o.dot(r,s)<0?!0:!1}function g(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var s=a,u=c,v=e,w=g,x=h;x=x||0;var y=j.length?j.pop():new p(v,s);y.bi=v,y.bj=s,o.sub(r,u,w),o.rotate(y.ni,t,x);var z=o.dot(r,y.ni);if(z>0)return!1;if(o.scale(r,y.ni,z),o.sub(y.ri,u,r),o.sub(y.ri,y.ri,v.position),o.sub(y.rj,u,s.position),i.push(y),k){var A=m.length?m.pop():new q(v,s);return A.bi=v,A.bj=s,A.setSlipForce(n),o.copy(A.ri,y.ri),o.copy(A.rj,y.rj),o.rotate(A.t,y.ni,-Math.PI/2),l.push(A),!0}return!1}function h(a,b,c,d){var e=a.radius;return o.sub(r,b,d),o.squaredLength(r)<e*e}function i(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var s=a,t=b,u=c,v=e,w=g,x=j.length?j.pop():new p(s,v);if(x.bi=s,x.bj=v,o.sub(r,w,u),o.squaredLength(r)>t.radius)return!1;if(o.copy(x.ni,r),o.normalize(x.ni,x.ni),o.scale(x.ri,x.ni,t.radius),o.add(x.ri,x.ri,u),o.sub(x.ri,x.ri,s.position),o.sub(x.rj,w,v.position),i.push(x),k){var y=m.length?m.pop():new q(s,v);y.bi=s,y.bj=v,y.setSlipForce(n),o.copy(y.ri,x.ri),o.copy(y.rj,x.rj),o.rotate(y.t,x.ni,-Math.PI/2),l.push(y)}return!0}function j(a,b,c,d,e){return e=e||0,o.sub(r,b,d),o.rotate(s,t,e),o.dot(r,s)<=a.radius?!0:!1}function k(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var r=a,w=b,x=c,y=e,z=g,A=h;A=A||0;var B=u;o.sub(B,x,z),o.rotate(s,t,A);var C=o.dot(s,B);if(C>w.radius)return!1;var D=j.length?j.pop():new p(y,r);D.bi=y,D.bj=r;var E=v;if(o.copy(D.ni,s),o.scale(D.rj,D.ni,-w.radius),o.add(D.rj,D.rj,x),o.sub(D.rj,D.rj,r.position),o.scale(E,D.ni,C),o.sub(D.ri,B,E),o.add(D.ri,D.ri,z),o.sub(D.ri,D.ri,y.position),i.push(D),k){var F=m.length?m.pop():new q(y,r);F.bi=y,F.bj=r,F.setSlipForce(n),o.copy(F.ri,D.ri),o.copy(F.rj,D.rj),o.rotate(F.t,D.ni,-Math.PI/2),l.push(F)}return!0}function l(a,b,c){var d,e,f=null,g=null;o.rotate(w,b,a.angle);for(var h=o.dot(a.position,b),i=1;i<a.shape.vertices.length;i++)d=a.shape.vertices[i],e=o.dot(d,w),(null===f||e>f)&&(f=e),(null===g||g>e)&&(g=e);o.set(c,g+h,f+h)}function m(a,b,c){for(var d=null,e=!1,f=0;2>f;f++)for(var g=0==f?a:b,h=1;h<a.shape.vertices.length;h++){o.subtract(x,g.shape.vertices[h],g.shape.vertices[h-1]),o.rotate(y,x,-Math.PI/2),o.normalize(y,y),l(a,y,z),l(b,y,A);var i=z,j=A;z[0]>A[0]&&(j=z,i=A);var k=j[1]-i[0];(null===d||k>d)&&(o.copy(c,y),d=k,e=k>0)}return e}function n(a,b){o.rotate(w,b,a.angle);for(var c=-1,d=1;d<a.shape.vertices.length;d++){o.subtract(x,a.shape.vertices[d],a.shape.vertices[d-1]),o.rotate(y,x,-Math.PI/2),o.normalize(y,y);var e=o.dot(y,b);(-1==c||e>maxDot)&&(c=d-1,maxDot=e)}return c}var o=a("../math/vec2"),p=a("../constraints/ContactEquation").ContactEquation,q=a("../constraints/FrictionEquation").FrictionEquation,r=o.create(),s=o.create(),t=o.fromValues(0,1);c.checkCircleCircle=d,c.nearphaseCircleCircle=e,c.checkParticlePlane=f,c.nearphaseParticlePlane=g,c.checkCircleParticle=h,c.nearphaseCircleParticle=i,c.checkCirclePlane=j;var u=o.create(),v=o.create();c.nearphaseCirclePlane=k;var w=o.create();c.projectConvexOntoAxis=l;var x=o.create(),y=o.create(),z=o.create(),A=o.create();c.findSeparatingAxis=m,c.nearphaseConvexConvex=function(a,b,c){var d=n(a,c),e=n(b,c);return-1==d||-1==e?!1:(o.create(),o.create(),o.create(),o.create(),o.create(),o.create(),void 0)},c.Broadphase=function(){},c.Broadphase.prototype.getCollisionPairs=function(){throw new Error("getCollisionPairs must be implemented in a subclass!")}},{"../constraints/ContactEquation":7,"../constraints/FrictionEquation":10,"../math/vec2":13}],4:[function(a,b,c){var d=a("../objects/Shape").Circle,e=a("../objects/Shape").Plane,f=a("../objects/Shape").Particle,g=a("../collision/Broadphase"),h=g.Broadphase;a("../math/vec2"),c.GridBroadphase=function(a,b,c,i,j,k){h.apply(this),j=j||10,k=k||10;var l=(b-a)/j,m=(i-c)/k;this.getCollisionPairs=function(h){for(var n=[],o=h.bodies,p=p=o.length,q=[],r=j*k,s=0;r>s;s++)q.push([]);for(var t=j/(b-a),u=k/(i-c),s=0;s!==p;s++){var v=o[s],w=v.shape;if(void 0!==w)if(w instanceof d)for(var x=v.position[0],y=v.position[1],z=w.radius,A=Math.floor(t*(x-z-a)),B=Math.floor(u*(y-z-c)),C=Math.floor(t*(x+z-a)),D=Math.floor(u*(y+z-c)),E=A;C>=E;E++)for(var F=B;D>=F;F++){var G=E,H=F;G*(k-1)+H>=0&&r>G*(k-1)+H&&q[G*(k-1)+H].push(v)}else{if(!(w instanceof e))throw new Error("Shape not supported in GridBroadphase!");if(0==v.angle)for(var y=v.position[1],E=0;E!==r&&y>c+m*(E-1);E++)for(var F=0;j>F;F++){var G=F,H=Math.floor(u*(m*E-c));q[G*(k-1)+H].push(v)}else if(v.angle==.5*Math.PI)for(var x=v.position[0],E=0;E!==r&&x>a+l*(E-1);E++)for(var F=0;k>F;F++){var H=F,G=Math.floor(t*(l*E-a));q[G*(k-1)+H].push(v)}else for(var E=0;E!==r;E++)q[E].push(v)}}for(var s=0;s!==r;s++)for(var I=q[s],E=0,J=I.length;E!==J;E++)for(var v=I[E],w=v.shape,F=0;F!==E;F++){var K=I[F],L=K.shape;w instanceof d?L instanceof d?g.checkCircleCircle(v,K,n):L instanceof f?g.checkCircleParticle(v,K,n):L instanceof e&&g.checkCirclePlane(v,K,n):w instanceof f?L instanceof d&&g.checkCircleParticle(K,v,n):w instanceof e&&L instanceof d&&g.checkCirclePlane(K,v,n)}return n}},c.GridBroadphase.prototype=new h},{"../collision/Broadphase":3,"../math/vec2":13,"../objects/Shape":15}],5:[function(a,b,c){function d(){g.apply(this)}var e=(a("../objects/Shape").Circle,a("../objects/Shape").Plane,a("../objects/Shape").Shape),f=(a("../objects/Shape").Particle,a("../collision/Broadphase")),g=f.Broadphase,h=a("../math/vec2");c.NaiveBroadphase=d,d.prototype=new Object(g.prototype);var i=h.fromValues(0,0),j=h.fromValues(0,0),k=h.fromValues(0,0);d.prototype.getCollisionPairs=function(a){for(var b=a.bodies,c=[],d=0,g=b.length;d!==g;d++)for(var l=b[d],m=0;d>m;m++)for(var n=b[m],o=!1,p=0;!o&&p<l.shapes.length;p++)for(var q=l.shapes[p],r=l.shapeOffsets[p]||k,s=l.shapeAngles[p]||0,t=0;!o&&t<n.shapes.length;t++){var u=n.shapes[t],v=n.shapeOffsets[t]||k,w=n.shapeAngles[t]||0,x=l,y=n,z=q,A=u,B=r,C=v,D=s,E=w;if(z.type>A.type){var F;F=x,x=y,y=F,F=z,z=A,A=F,F=B,B=C,C=F,F=D,D=E,E=F}h.rotate(i,B,x.angle),h.rotate(j,C,y.angle),h.add(i,i,x.position),h.add(j,j,y.position),D+x.angle;var G=E+y.angle;switch(z.type){case e.CIRCLE:switch(A.type){case e.CIRCLE:o=f.checkCircleCircle(z,i,A,j);break;case e.PLANE:o=f.checkCirclePlane(z,i,A,j,G);break;case e.PARTICLE:o=f.checkCircleParticle(z,i,A,j)}break;case e.PARTICLE:switch(A.type){case e.PLANE:o=f.checkParticlePlane(z,i,A,j,G)}}o&&(o=!0,c.push(x,y))}return c}},{"../collision/Broadphase":3,"../math/vec2":13,"../objects/Shape":15}],6:[function(a,b,c){function d(a,b){this.equations=[],this.bodyA=a,this.bodyB=b}c.Constraint=d},{}],7:[function(a,b,c){function d(a,b){e.call(this,a,b,0,1e6),this.penetration=0,this.ri=f.create(),this.penetrationVec=f.create(),this.rj=f.create(),this.ni=f.create(),this.rixn=f.create(),this.rjxn=f.create(),this.rixw=f.create(),this.rjxw=f.create(),this.relVel=f.create(),this.relForce=f.create()}var e=a("./Equation").Equation,f=a("../math/vec2");c.ContactEquation=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeB=function(a,b,c){var d=this.bi,e=this.bj,g=this.ri,h=this.rj,i=d.position,j=e.position,k=d.velocity,l=d.angularVelocity,m=d.force,n=d.angularForce,o=e.velocity,p=e.angularVelocity,q=e.force,r=e.angularForce,s=(this.relVel,this.relForce,this.penetrationVec),t=d.invMass,u=e.invMass,v=d.invInertia,w=e.invInertia,x=this.ni,y=this.rixn=f.crossLength(g,x),z=this.rjxn=f.crossLength(h,x);f.set(s,0,0),f.add(s,j,h),f.sub(s,s,i),f.sub(s,s,g);var A=f.dot(x,s),B=f.dot(o,x)-f.dot(k,x)+p*z-l*y,C=f.dot(q,x)*u-f.dot(m,x)*t+w*r*z-v*n*y,D=-A*a-B*b-c*C;return D},d.prototype.computeC=function(a){var b=this.bi,c=this.bj,d=this.rixn,e=this.rjxn,f=b.invMass+c.invMass+a;return f+=b.invInertia*d*d,f+=c.invInertia*e*e};{f.create()}d.prototype.computeGWlambda=function(){var a=this.bi,b=this.bj,c=0;return c-=f.dot(this.ni,a.vlambda),c-=a.wlambda*this.rixn,c+=f.dot(this.ni,b.vlambda),c+=b.wlambda*this.rjxn};var g=f.create();d.prototype.addToWlambda=function(a){var b=this.bi,c=this.bj,d=this.rixn,e=this.rjxn,h=this.ni,i=g;f.scale(i,h,-b.invMass*a),f.add(b.vlambda,b.vlambda,i),f.scale(i,h,c.invMass*a),f.add(c.vlambda,c.vlambda,i),b.wlambda-=b.invInertia*d*a,c.wlambda+=c.invInertia*e*a}},{"../math/vec2":13,"./Equation":9}],8:[function(a,b,c){function d(a,b,c,d){e.call(this,a,b),this.distance=c,"undefined"==typeof d&&(d=1e6);var g=this.equations=[new f(a,b)],h=g[0];h.minForce=-d,h.maxForce=d}var e=a("./Constraint").Constraint,f=a("./ContactEquation").ContactEquation,g=a("../math/vec2");c.DistanceConstraint=d,d.prototype=new e,d.prototype.update=function(){var a=this.equations[0],b=this.bodyA,c=this.bodyB,d=this.distance;g.subtract(a.ni,c.position,b.position),g.normalize(a.ni,a.ni),g.scale(a.ri,a.ni,.5*d),g.scale(a.rj,a.ni,.5*-d)}},{"../math/vec2":13,"./Constraint":6,"./ContactEquation":7}],9:[function(a,b,c){function d(a,b,c,d){this.id=-1,this.minForce="undefined"==typeof c?-1e6:c,this.maxForce="undefined"==typeof d?1e6:d,this.bi=a,this.bj=b,this.h=1/60,this.k=0,this.a=0,this.b=0,this.eps=0,this.setSpookParams(1e6,4)}c.Equation=d,d.prototype.constructor=d,d.prototype.setSpookParams=function(a,b){var c=this.h;this.k=a,this.d=b,this.a=4/(c*(1+4*b)),this.b=4*b/(1+4*b),this.eps=4/(c*c*a*(1+4*b))}},{}],10:[function(a,b,c){function d(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a}function e(a,b,c){g.call(this,a,b,-c,c),this.ri=f.create(),this.rj=f.create(),this.t=f.create(),this.rixt=0,this.rjxt=0}var f=a("../math/vec2"),g=a("./Equation").Equation;c.FrictionEquation=e;var h=f.dot;e.prototype=new g,e.prototype.constructor=e,e.prototype.setSlipForce=function(a){this.maxForce=a,this.minForce=-a};var i=[0,0,0],j=[0,0,0];e.prototype.computeB=function(a,b,c){var a=this.a,b=this.b,e=this.bi,f=this.bj,g=this.ri,k=this.rj,l=this.rixt,m=this.rjxt,n=this.t;d(i,[g[0],g[1],0],[n[0],n[1],0]),d(j,[k[0],k[1],0],[n[0],n[1],0]);var l=this.rixt=i[2],m=this.rjxt=j[2],o=0,p=-h(e.velocity,n)+h(f.velocity,n)-l*e.angularVelocity+m*f.angularVelocity,q=-h(e.force,n)*e.invMass+h(f.force,n)*f.invMass-l*e.invInertia*e.angularForce+m*f.invInertia*f.angularForce,r=-o*a-p*b-c*q;return r},e.prototype.computeC=function(a){var b,c=this.bi,d=this.bj,e=this.rixt,f=this.rjxt;return b=c.invMass+d.invMass+a,b+=c.invInertia*e*e,b+=d.invInertia*f*f},e.prototype.computeGWlambda=function(){var a=this.bi,b=this.bj,c=0;return c-=f.dot(this.t,a.vlambda),c-=a.wlambda*this.rixt,c+=f.dot(this.t,b.vlambda),c+=b.wlambda*this.rjxt};var k=f.create();e.prototype.addToWlambda=function(a){var b=this.bi,c=this.bj,d=this.rixt,e=this.rjxt,g=this.t,h=k;f.scale(h,g,-b.invMass*a),f.add(b.vlambda,b.vlambda,h),f.scale(h,g,c.invMass*a),f.add(c.vlambda,c.vlambda,h),b.wlambda-=b.invInertia*d*a,c.wlambda+=c.invInertia*e*a}},{"../math/vec2":13,"./Equation":9}],11:[function(a,b,c){function d(a,b,c,d,g){e.call(this,a,c),g="undefined"!=typeof g?g:1e7,this.pivotA=b,this.pivotB=d;var h=this.equations=[new f(a,c),new f(a,c)],i=h[0],j=h[1];j.minForce=i.minForce=-g,j.maxForce=i.maxForce=g}var e=a("./Constraint").Constraint,f=a("./ContactEquation").ContactEquation,g=a("../math/vec2");c.PointToPointConstraint=d,d.prototype=new e,d.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=this.pivotA,d=this.pivotB,e=this.equations,f=e[0],h=e[1];g.subtract(f.ni,b.position,a.position),g.normalize(f.ni,f.ni),g.rotate(f.ri,c,a.angle),g.rotate(f.rj,d,b.angle),g.rotate(h.ni,f.ni,Math.PI/2),g.copy(h.ri,f.ri),g.copy(h.rj,f.rj)}},{"../math/vec2":13,"./Constraint":6,"./ContactEquation":7}],12:[function(a,b,c){var d=function(){};c.EventEmitter=d,d.prototype={constructor:d,on:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;return void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b),this},has:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},off:function(a,b){if(void 0!==this._listeners){var c=this._listeners,d=c[a].indexOf(b);-1!==d&&c[a].splice(d,1)}},emit:function(a){if(void 0!==this._listeners){var b=this._listeners,c=b[a.type];if(void 0!==c){a.target=this;for(var d=0,e=c.length;e>d;d++)c[d].call(this,a)}return this}}}},{}],13:[function(a,b){var c=a("../../node_modules/gl-matrix/src/gl-matrix/vec2").vec2;c.getX=function(a){return a[0]},c.getY=function(a){return a[1]},c.crossLength=function(a,b){return a[0]*b[1]-a[1]*b[0]},c.crossVZ=function(a,b,d){return c.rotate(a,b,-Math.PI/2),c.scale(a,a,d),a},c.crossZV=function(a,b,d){return c.rotate(a,d,Math.PI/2),c.scale(a,a,b),a},c.rotate=function(a,b,c){var d=Math.cos(c),e=Math.sin(c);a[0]=d*b[0]-e*b[1],a[1]=e*b[0]+d*b[1]},b.exports=c},{"../../node_modules/gl-matrix/src/gl-matrix/vec2":1}],14:[function(a,b,c){function d(a){a=a||{},this.id=++d._idCounter,this.shapes=[],this.shapeOffsets=[],this.shapeAngles=[],this.mass=a.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.updateMassProperties(),this.position=e.fromValues(0,0),a.position&&e.copy(this.position,a.position),this.velocity=e.fromValues(0,0),a.velocity&&e.copy(this.velocity,a.velocity),this.vlambda=e.fromValues(0,0),this.wlambda=0,this.angle=a.angle||0,this.angularVelocity=a.angularVelocity||0,this.force=e.create(),a.force&&e.copy(this.force,a.force),this.angularForce=a.angularForce||0,this.motionState=0==this.mass?d.STATIC:d.DYNAMIC}var e=a("../math/vec2");c.Body=d,d._idCounter=0,d.prototype.addShape=function(a,b,c){this.shapes.push(a),this.shapeOffsets.push(b),this.shapeAngles.push(c),this.updateMassProperties()};var f=e.fromValues(0,0);d.prototype.updateMassProperties=function(){for(var a=this.shapes,b=a.length,c=this.mass/b,d=0,g=0;b>g;g++){var h=a[g],i=e.squaredLength(this.shapeOffsets[g]||f),j=h.computeMomentOfInertia(c);d+=j+c*i}this.inertia=d,this.invMass=this.mass>0?1/this.mass:0,this.invInertia=d>0?1/d:0};var g=e.create();d.prototype.applyForce=function(a,b){var c=g;e.sub(c,b,this.position),e.add(this.force,this.force,a);var d=e.crossLength(c,a);this.angularForce+=d},d.DYNAMIC=1,d.STATIC=2,d.KINEMATIC=4},{"../math/vec2":13}],15:[function(a,b,c){function d(a){this.type=a}function e(){d.call(this,d.PARTICLE)}function f(a){d.call(this,d.CIRCLE),this.radius=a||1}function g(){d.call(this,d.PLANE)}function h(a){d.call(this,d.CONVEX),this.vertices=a}function i(a){d.call(this,d.LINE),this.length=a}c.Shape=d,c.Particle=e,c.Circle=f,c.Plane=g,c.Convex=h,c.Line=i,d.CIRCLE=1,d.PARTICLE=2,d.PLANE=4,d.CONVEX=8,d.LINE=16,d.prototype.computeMomentOfInertia=function(){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")},e.prototype=new d,e.prototype.computeMomentOfInertia=function(){return 0},f.prototype=new d,f.prototype.computeMomentOfInertia=function(a){var b=this.radius;return a*b*b/2},g.prototype=new d,g.prototype.computeMomentOfInertia=function(){return 0},h.prototype=new d,h.prototype.computeMomentOfInertia=function(){return 1},i.prototype=new d,i.prototype.computeMomentOfInertia=function(a){return a*Math.pow(this.length,2)/12}},{}],16:[function(a,b,c){function d(a,b,c){c=c||{},this.restLength=c.restLength||1,this.stiffness=c.stiffness||100,this.damping=c.damping||1,this.bodyA=a,this.bodyB=b}var e=a("../math/vec2");c.Spring=d;var f=e.create(),g=e.create(),h=e.create(),i=e.create();d.prototype.applyForce=function(){var a=this.stiffness,b=this.damping,c=this.restLength,d=this.bodyA,j=this.bodyB,k=f,l=g,m=h,n=i;e.sub(k,d.position,j.position),e.sub(m,d.velocity,j.velocity);var o=e.len(k);e.normalize(l,k),e.scale(n,l,a*(o-c)+b*e.dot(m,l)),e.sub(d.force,d.force,n),e.add(j.force,j.force,n)}},{"../math/vec2":13}],17:[function(a,b,c){c.Body=a("./objects/Body").Body,c.Broadphase=a("./collision/Broadphase").Broadphase,c.Circle=a("./objects/Shape").Circle,c.Constraint=a("./constraints/Constraint").Constraint,c.ContactEquation=a("./constraints/ContactEquation").ContactEquation,c.DistanceConstraint=a("./constraints/DistanceConstraint").DistanceConstraint,c.Equation=a("./constraints/Equation").Equation,c.EventEmitter=a("./events/EventEmitter").EventEmitter,c.FrictionEquation=a("./constraints/FrictionEquation").FrictionEquation,c.GridBroadphase=a("./collision/GridBroadphase").GridBroadphase,c.GSSolver=a("./solver/GSSolver").GSSolver,c.Island=a("./solver/IslandSolver").Island,c.IslandSolver=a("./solver/IslandSolver").IslandSolver,c.Line=a("./objects/Shape").Line,c.NaiveBroadphase=a("./collision/NaiveBroadphase").NaiveBroadphase,c.Particle=a("./objects/Shape").Particle,c.Plane=a("./objects/Shape").Plane,c.PointToPointConstraint=a("./constraints/PointToPointConstraint").PointToPointConstraint,c.Shape=a("./objects/Shape").Shape,c.Solver=a("./solver/Solver").Solver,c.Spring=a("./objects/Spring").Spring,c.World=a("./world/World").World,c.vec2=a("./math/vec2")},{"./collision/Broadphase":3,"./collision/GridBroadphase":4,"./collision/NaiveBroadphase":5,"./constraints/Constraint":6,"./constraints/ContactEquation":7,"./constraints/DistanceConstraint":8,"./constraints/Equation":9,"./constraints/FrictionEquation":10,"./constraints/PointToPointConstraint":11,"./events/EventEmitter":12,"./math/vec2":13,"./objects/Body":14,"./objects/Shape":15,"./objects/Spring":16,"./solver/GSSolver":18,"./solver/IslandSolver":19,"./solver/Solver":20,"./world/World":21}],18:[function(a,b,c){function d(a){f.call(this),a=a||{},this.iterations=a.iterations||10,this.h=a.timeStep||1/60,this.k=a.stiffness||1e7,this.d=a.relaxation||6,this.a=0,this.b=0,this.eps=0,this.tolerance=a.tolerance||0,this.setSpookParams(this.k,this.d),this.debug=a.debug||!1,this.arrayStep=30,this.lambda=new g(this.arrayStep),this.Bs=new g(this.arrayStep),this.invCs=new g(this.arrayStep),this.setSpookParams(1e6,4)}var e=a("../math/vec2"),f=a("./Solver").Solver;c.GSSolver=d;var g=Float32Array||Array;d.prototype=new f,d.prototype.setSpookParams=function(a,b){var c=this.h;this.k=a,this.d=b,this.a=4/(c*(1+4*b)),this.b=4*b/(1+4*b),this.eps=4/(c*c*a*(1+4*b))},d.prototype.solve=function(a,b){var c=(this.d,this.k,0),d=this.iterations,f=this.tolerance*this.tolerance,h=this.a,i=this.b,j=this.eps,k=this.equations,l=k.length,m=b.bodies,n=b.bodies.length,o=a;this.lambda.length<l&&(this.lambda=new g(l+this.arrayStep),this.Bs=new g(l+this.arrayStep),this.invCs=new g(l+this.arrayStep));for(var p=this.invCs,q=this.Bs,r=this.lambda,s=0;s!==l;s++){var t=k[s];r[s]=0,q[s]=t.computeB(h,i,o),p[s]=1/t.computeC(j)}var u,t,v,w,x,y,z;if(0!==l){var s,A,B,C,D;for(s=0;s!==n;s++){var i=m[s],E=i.vlambda;e.set(E,0,0),i.wlambda=0}for(c=0;c!==d;c++){for(x=0,A=0;A!==l;A++)t=k[A],C=t.maxForce,B=t.minForce,u=q[A],v=p[A],z=r[A],y=t.computeGWlambda(j),w=v*(u-y-j*z),D=z+w,B>D?w=B-z:D>C&&(w=C-z),r[A]+=w,x+=Math.abs(w),t.addToWlambda(w);if(f>=x*x)break}for(s=0;s!==n;s++){var i=m[s],F=i.velocity;e.add(F,F,i.vlambda),i.angularVelocity+=i.wlambda}}errorTot=x}},{"../math/vec2":13,"./Solver":20}],19:[function(a,b,c){function d(a){h.call(this),this.subsolver=a,this.numIslands=0,this._nodePool=[]}function e(a){for(var b=a.length,c=0;c!==b;c++){var d=a[c];if(!(d.visited||d.body.motionState&j))return d}return!1}function f(a,b){var c=[];for(c.push(a),a.visited=!0,b(a);c.length;)for(var d,f=c.pop();d=e(f.children);)d.visited=!0,b(d),c.push(d)}function g(){this.equations=[],this.bodies=[]}var h=a("./Solver").Solver,i=(a("../constraints/ContactEquation").ContactEquation,a("../math/vec2"),a("../objects/Body").Body),j=i.STATIC;c.IslandSolver=d,c.Island=g,d.prototype=new Object(h.prototype),d.prototype.solve=function(a,b){function c(a){v.push(a.body);for(var b=a.eqs.length,c=0;c!==b;c++){var d=a.eqs[c];-1===u.indexOf(d)&&u.push(d)}}var d=[],h=b.bodies,i=this.equations,j=i.length,k=h.length;this.subsolver,this._workers,this._workerData,this._workerIslandGroups;for(var l=0;l!==k;l++)this._nodePool.length?d.push(this._nodePool.pop()):d.push({body:h[l],children:[],eqs:[],visited:!1});for(var l=0;l!==k;l++){var m=d[l];m.body=h[l],m.children.length=0,m.eqs.length=0,m.visited=!1}for(var n=0;n!==j;n++){var o=i[n],l=h.indexOf(o.bi),p=h.indexOf(o.bj),q=d[l],r=d[p];q.children.push(r),q.eqs.push(o),r.children.push(q),r.eqs.push(o)}for(var s,t=0,u=[],v=[],w=[];s=e(d);){var x=new g;u.length=0,v.length=0,f(s,c);for(var y=u.length,l=0;l!==y;l++){var o=u[l];x.equations.push(o)}t++,w.push(x)}this.numIslands=t;for(var l=0;l<w.length;l++)w[l].solve(a,this.subsolver)},g.prototype.reset=function(){this.equations.length=this.bodies.length=0},g.prototype.getBodies=function(){for(var a=[],b=[],c=this.equations,d=0;d!==c.length;d++){var e=c[d];-1===b.indexOf(e.bi.id)&&(a.push(e.bi),b.push(e.bi.id)),-1===b.indexOf(e.bj.id)&&(a.push(e.bj),b.push(e.bj.id))}return a},g.prototype.solve=function(a,b){var c=[];b.removeAllEquations();for(var d=this.equations.length,e=0;e!==d;e++)b.addEquation(this.equations[e]);for(var f=this.getBodies(),g=f.length,e=0;e!==g;e++)c.push(f[e]);b.solve(a,{bodies:c})}},{"../constraints/ContactEquation":7,"../math/vec2":13,"../objects/Body":14,"./Solver":20}],20:[function(a,b,c){function d(){this.equations=[]}c.Solver=d,d.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")},d.prototype.addEquation=function(a){this.equations.push(a)},d.prototype.removeEquation=function(a){var b=this.equations.indexOf(a);-1!=b&&this.equations.splice(b,1)},d.prototype.removeAllEquations=function(){this.equations=[]}},{}],21:[function(a,b,c){function d(){return performance.now?performance.now():performance.webkitNow?performance.webkitNow():(new Date).getTime()}function e(a){m.apply(this),a=a||{},this.springs=[],this.bodies=[],this.solver=a.solver||new f,this.contacts=[],this.oldContacts=[],this.frictionEquations=[],this.oldFrictionEquations=[],this.gravity=a.gravity||h.fromValues(0,-9.78),this.doProfiling=a.doProfiling||!1,this.lastStepTime=0,this.broadphase=a.broadphase||new g,this.constraints=[],this.friction=.1,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.addSpringEvent={type:"addSpring",body:null}}var f=a("../solver/GSSolver").GSSolver,g=a("../collision/NaiveBroadphase").NaiveBroadphase,h=a("../math/vec2"),i=a("../objects/Shape").Circle,j=(a("../objects/Shape").Compound,a("../objects/Shape").Line),k=a("../objects/Shape").Plane,l=a("../objects/Shape").Particle,m=a("../events/EventEmitter").EventEmitter,n=a("../objects/Body").Body,o=a("../objects/Spring").Spring,p=a("../constraints/DistanceConstraint").DistanceConstraint,q=a("../constraints/PointToPointConstraint").PointToPointConstraint,r=a("../collision/Broadphase"),s=a("../../package.json");r.Broadphase,c.World=e,e.prototype=new Object(m.prototype),e.prototype.addConstraint=function(a){this.constraints.push(a),a.id=this._constraintIdCounter++},e.prototype.removeConstraint=function(a){var b=this.constraints.indexOf(a);-1!==b&&this.constraints.splice(b,1)},h.create(),h.create(),h.create(),h.create();var t=h.create(),u=h.create(),v=h.fromValues(0,0),w=h.fromValues(0,0),x=h.fromValues(0,0);e.prototype.step=function(a){var b,c,e=this,f=this.doProfiling,g=this.springs.length,j=this.springs,m=this.bodies,n=this.gravity,o=this.solver,p=this.bodies.length,q=this.broadphase,s=this.constraints;f&&(b=d());for(var y=0;y!==p;y++){var z=m[y].force;h.add(z,z,n)}for(var y=0;y!==g;y++){var A=j[y];A.applyForce()}for(var B=q.getCollisionPairs(this),C=this.contacts.concat(this.oldContacts),D=this.frictionEquations.concat(this.oldFrictionEquations),E=this.contacts=[],F=this.frictionEquations=[],G=h.length(this.gravity),y=0,H=B.length;y!==H;y+=2){var I=B[y],J=B[y+1],K=I.invMass+J.invMass;K>0&&(K=1/K);for(var L=this.friction,M=L*G*K,N=L>0,O=0;O<I.shapes.length;O++)for(var P=I.shapes[O],Q=I.shapeOffsets[O]||x,R=I.shapeAngles[O]||0,S=0;S<I.shapes.length;S++){var T=J.shapes[S],U=J.shapeOffsets[S]||x,V=J.shapeAngles[S]||0;h.rotate(v,Q,I.angle),h.rotate(w,U,J.angle),h.add(v,v,I.position),h.add(w,w,J.position);var W=R+I.angle,X=V+J.angle;P instanceof i?T instanceof i?r.nearphaseCircleCircle(I,P,v,W,J,T,w,X,E,C,N,F,D,M):T instanceof l?r.nearphaseCircleParticle(I,P,v,W,J,T,w,X,E,C,N,F,D,M):T instanceof k&&r.nearphaseCirclePlane(I,P,v,W,J,T,w,X,E,C,N,F,D,M):P instanceof l?T instanceof i?r.nearphaseCircleParticle(J,T,w,X,I,P,v,W,E,C,N,F,D,M):T instanceof k&&r.nearphaseParticlePlane(I,P,v,W,J,T,w,X,E,C,N,F,D,M):P instanceof k&&(T instanceof i?r.nearphaseCirclePlane(J,T,w,X,I,P,v,W,E,C,N,F,D,M):T instanceof l&&r.nearphaseParticlePlane(J,T,w,X,I,P,v,W,E,C,N,F,D,M))}}this.oldContacts=C,this.oldFrictionEquations=D;for(var y=0,Y=E.length;y!==Y;y++)o.addEquation(E[y]);for(var y=0,Z=F.length;y!==Z;y++)o.addEquation(F[y]);var $=s.length;for(y=0;y!==$;y++){var _=s[y];_.update();for(var ab=0,bb=_.equations.length;ab!==bb;ab++){var cb=_.equations[ab];o.addEquation(cb)}}o.solve(a,this),o.removeAllEquations();for(var db=t,eb=u,y=0;y!==p;y++){var fb=m[y];if(fb.mass>0){var gb=1/fb.mass,hb=fb.force,ib=fb.position,jb=fb.velocity;fb.angularVelocity+=fb.angularForce*fb.invInertia*a,fb.angle+=fb.angularVelocity*a,h.scale(db,hb,a*gb),h.add(jb,db,jb),h.scale(eb,jb,a),h.add(ib,ib,eb)}}for(var y=0;y!==p;y++){var I=m[y];h.set(I.force,0,0),I.angularForce=0}f&&(c=d(),e.lastStepTime=c-b),this.emit(this.postStepEvent)},e.prototype.addSpring=function(a){this.springs.push(a),this.addSpringEvent.spring=a,this.emit(this.addSpringEvent)},e.prototype.removeSpring=function(a){var b=this.springs.indexOf(a);-1===b&&this.springs.splice(b,1)},e.prototype.addBody=function(a){this.bodies.push(a),this.addBodyEvent.body=a,this.emit(this.addBodyEvent)},e.prototype.removeBody=function(a){var b=this.bodies.indexOf(a);-1!==b&&this.bodies.splice(b,1)},e.prototype.toJSON=function(){function a(a){return[a[0],a[1]]}for(var b={p2:s.version,bodies:[],springs:[],solver:{},gravity:a(this.gravity),broadphase:{},constraints:[]},c=0;c<this.springs.length;c++){var d=this.springs[c];b.springs.push({bodyA:this.bodies.indexOf(d.bodyA),bodyB:this.bodies.indexOf(d.bodyB),stiffness:d.stiffness,damping:d.damping,restLength:d.restLength})}for(var c=0;c<this.constraints.length;c++){var e=this.constraints[c],f={bodyA:this.bodies.indexOf(e.bodyA),bodyB:this.bodies.indexOf(e.bodyB)};if(e instanceof p)f.type="DistanceConstraint",f.distance=e.distance;else{if(!(e instanceof q))throw new Error("Constraint not supported yet!");f.type="PointToPointConstraint",f.pivotA=a(e.pivotA),f.pivotB=a(e.pivotB),f.maxForce=e.maxForce}b.constraints.push(f)}for(var c=0;c<this.bodies.length;c++){for(var g=this.bodies[c],h=g.shapes,m=[],n=0;n<h.length;n++){var o,d=h[n];if(d instanceof i)o={type:"Circle",radius:d.radius};else if(d instanceof k)o={type:"Plane"};else if(d instanceof l)o={type:"Particle"};else{if(!(d instanceof j))throw new Error("Shape type not supported yet!");o={type:"Line",length:d.length}}o.offset=a(g.shapeOffsets[n]||[0,0]),o.angle=g.shapeAngles[n]||0,m.push(o)}b.bodies.push({mass:g.mass,angle:g.angle,position:a(g.position),velocity:a(g.velocity),angularVelocity:g.angularVelocity,force:a(g.force),shapes:m})}return b},e.prototype.fromJSON=function(a){if(this.clear(),!a.p2)return!1;switch(a.p2){case s.version:h.copy(world.gravity,a.gravity);for(var b=0;b<a.bodies.length;b++){for(var c=a.bodies[b],d=c.shapes,e=new n({mass:c.mass,position:c.position,angle:c.angle,velocity:c.velocity,angularVelocity:c.angularVelocity,force:c.force}),f=0;f<d.length;f++){var g,m=d[f];switch(m.type){case"Circle":g=new i(m.radius);break;case"Plane":g=new k;break;case"Particle":g=new l;break;case"Line":g=new j(m.length);break;default:throw new Error("Shape type not supported: "+m.type)}e.addShape(g,m.offset,m.angle)}this.addBody(e)}for(var b=0;b<a.springs.length;b++){var m=a.springs[b],r=new o(this.bodies[m.bodyA],this.bodies[m.bodyB],{stiffness:m.stiffness,damping:m.damping,restLength:m.restLength});this.addSpring(r)}for(var b=0;b<a.constraints.length;b++){var t,u=a.constraints[b];switch(u.type){case"DistanceConstraint":t=new p(this.bodies[u.bodyA],this.bodies[u.bodyB],u.distance);break;case"PointToPointConstraint":t=new q(this.bodies[u.bodyA],u.pivotA,this.bodies[u.bodyB],u.pivotB,u.maxForce);break;default:throw new Error("Constraint type not recognized: "+u.type)}this.addConstraint(t)}break;default:return!1}return!0},e.prototype.clear=function(){for(var a=this.constraints,b=a.length-1;b>=0;b--)this.removeConstraint(a[b]);
for(var c=this.bodies,b=c.length-1;b>=0;b--)this.removeBody(c[b]);for(var d=this.springs,b=d.length-1;b>=0;b--)this.removeSpring(d[b])}},{"../../package.json":2,"../collision/Broadphase":3,"../collision/NaiveBroadphase":5,"../constraints/DistanceConstraint":8,"../constraints/PointToPointConstraint":11,"../events/EventEmitter":12,"../math/vec2":13,"../objects/Body":14,"../objects/Shape":15,"../objects/Spring":16,"../solver/GSSolver":18}]},{},[17])(17)});